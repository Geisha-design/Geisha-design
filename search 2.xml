<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>dns系统详细解析</title>
      <link href="2021/06/18/%E2%80%9Cdns%E7%B3%BB%E7%BB%9F%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90%E2%80%9D/"/>
      <url>2021/06/18/%E2%80%9Cdns%E7%B3%BB%E7%BB%9F%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90%E2%80%9D/</url>
      
        <content type="html"><![CDATA[<p>DNS系统概述</p><p>域名系统DNS（domain name system）是因特网使用的命名系统，用来把便于人们记忆的含有特定含义的主机名转换为便于机器处理的IP地址，值得注意的是，DNS系统采用C/S架构，其协议运行在UDP之上，使用53号端口。<br>DNS分为三个部分，层次域名空间，域名服务器和解析器。<br>层次域名空间</p><p>因特网采用层次树状结构的命名方法。任何一个连接在因特网上的主机或者路由器，都有一个唯一的层次结构的名字，即域名（Domain name）域是名字空间中一个可以被管理的划分。域还可以被分为子域，而子域还可以继续划分为子域的子域，这样就形成了顶级域，二级域，三级域等。每一个域名都是由标号序列组成，各标号之间用点“.“”隔开。<br>举个例子：<a href="http://www.baidu.com/">www.baidu.com</a> 其中com是顶级域名，cskaoyan是二级域名，www是三级域名。<br>关于域名中的标号有以下几点值得注意：<br>1.英文不区分大小写。<br>2.标号中除了连字符-之外不能使用其他的标点符号。<br>3.每一个标号不超过63个字符，多标号组成的完整域名最长不超过255字符。<br>4.级别最低的域名写在最左边，级别最高的顶级域名写在最右边。</p><p>顶级域名（Top name domain TLD）：有以下大三类<br>1.国家级顶级域名nTLD，国家和某些地区的域名，如“.cn”表示中国，“.us”表示美国，“.uk”表示英国，“.hk”表示中国香港特区。<br>2.通用顶级域名gTLD.常见的有“.com”（公司企业）“.net”（网络服务机构）“.org”（非营利性的组织）“.gov”（美国的政府部门）等。<br>3.基础结构域名。这种顶级域名只有一个，即arga，用于反向域名解析，因此又称为反向域名。<br>国家顶级域名注册的二级域名均由国家自行确定。下图是域名空间的结构<img src="https://img-blog.csdnimg.cn/20181227145035233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FhMTkyODk5Mjc3Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>在域名系统中，每个域分别由不同的组织进</p><p>在域名系统中，每个域分别由不同的组织进行管理，每个组织都可以将它的域再分成一定数目的子域，并将这些子域委托给其他组织去管理。例如，管理CN域的中国将EDU.CN子域授权给中国教育和科研计算机网CERNET来管理。<br>域名服务器</p><p>因特网的域名系统被设计成一个联机分布式的数据库系统，并采用客户/服务器模式。域名到IP地址的解析是在域名服务器上进行的，一个服务器所负责（或者说是有权限的）的管辖范围称为区（不是以“域”为单位），各单位根据具体情况来划分自己管辖范围的区，但在一个区中的所有节点必须是能够连通的，每一个区设置相应的权限域名服务器，用来保护该区中的所有主机的域名IP地址的映射。每一个域名服务器不但能够进行一些域名到IP地址的解析，而且还必须具有连向其他域名服务器的信息，当自己不能进行域名到IP地址的转换时，能够知道什么地方去找别的域名服务器。</p><p>1.根域名服务器</p><p>根域名服务器是最高层次的域名服务器，所有的根域名服务器都知道所有的顶级域名服务器的IP地址。根域名服务器也是最重要的域名服务器，不管是哪一个本地域名服务器，若要对因特网上任何一个域名进行解析，只要自己无法解析，就首先要求助于根域名服务器。因特网上有着13个根域名服务器，尽管我们将这13个根域名服务器中的每个都是为单个的服务器，但每台“服务器”实际上是冗余服务器的集群，以提供安全性和可靠性。需要注意的是，根域名服务器用来管辖顶级域（.com）通常它并不直接把待查询的域名直接转换成IP地址，而是告诉本地域名服务器下一步应当照拿一个顶级域名服务器进行查询。</p><p>2.顶级域名服务器<br>这些域名服务器负责管理在该顶级域名服务器注册的二级域名。当收到DNS查询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当查找的域名服务器的IP地址）。</p><p>3.授权域名服务器（权限域名服务器）<br>每一个主机都必须在授权域名服务器处登记，为了更加可靠地工作，一个主机最好至少有两个授权域名服务器，实际上，许多域名服务器都同时充当本地域名服务器和授权域名服务器。授权域名服务器总是能够将其管辖的主机名的IP地址。</p><p>4.本地域名服务器<br>本地域名服务器对域名系统非常重要，每一个因特网服务提供者ISP，或一个大学，甚至一个大学里的系，都可以拥有一个本地域名服务器，当一个主机发出DNS查询请求时，这个查询请求报文就发送给该主机的本地域名服务器。事实上，我们在Windows系统中配置“本地连接”时，就需要填写DNS服务器地址，这个地址就是本地DNS域名服务器的地址。<br>DNS域名服务器的层次结构如图：</p><p> <img src="https://img-blog.csdnimg.cn/20181227150929581.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FhMTkyODk5Mjc3Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h2 id><a href="#" class="headerlink" title></a></h2><p>域名解析过程</p><p>域名解析也就是把域名映射成IP地址或者把IP地址映射成为域名的过程。前者称为正向解析，后者称为反向解析。当客户端需要域名解析时，通过本机的DNS客户端构造一个DNS请求报文，以UDP数据报方式发往本地域名服务器。</p><p>域名解析有两种方式：递归查询和迭代相结合的查询。<br>递归查询的过程如图所示，该方式由于给根域名服务器的负载过大，几乎不使用。</p><p> <img src="https://img-blog.csdnimg.cn/20181227151325924.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FhMTkyODk5Mjc3Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/20181227151342382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FhMTkyODk5Mjc3Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>（1）主机向本地域名服务器的查询采用的是递归查询。<br>如果本地主机所询问的本地域名服务器不知道被查询的域名IP地址，那么本地域名服务器就以DNS客户的身份，向根域名服务器继续发出查询请求报文（替该主机继续查询）<br>而不是让该主机自己进行下一步查询。在这种情况下，本地域名服务器只需要向根域名服务器查询一次，后面的几次查询都是递归地在其他几个域名服务器之间的进行的，在步骤7中，本地域名服务器从根域名服务器得到了所需要得IP地址，最后一步，本地域名服务器把查询结果告诉了主机。</p><p>（2）本地域名服务器向根域名服务器的查询采用迭代查询。<br>当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地域名服务器“下一步应当向哪一个顶级域名服务器进行查询”然后让本地域名服务器向这个顶级域名服务器进行后续的查询。同样，顶级域名服务器收到查询报文后，要么给出所要查询的IP地址，要么告诉本地域名服务器下一步应当向哪一个权限域名服务器查询。最后返还结果。</p><p>举个例子：<br>某主机希望获得y.abc.com的主机的IP地址，域名解析过程如下（共使用八个UDP报文）<br>1.客户机向本地域名服务器发出DNS请求报文。<br>2.本地域名服务器收到请求后，查询本地缓存，假设没有该记录，则以DNS客户的身份向根域名服务器发出解析请求。<br>3.根域名服务器收到请求后，判断该域名属于.com域，将对应的顶级域名服务器dns.com的IP地址返回给本地域名服务器。<br>4.本地域名服务器向顶级域名服务器dns.com发出解析请求报文<br>5.顶级域名服务器dns.com收到请求后，判断该域名属于abc.com域，故将对应的授权域名服务器dns.abc.com的IP地址返回给本地域名服务器。<br>6.本地域名服务器想授权域名服务器发起解析请求报文。<br>7.授权域名服务器dns.abc.com收到请求后，将查询结果返回给本地域名服务器。<br>8.本地域名服务器将查询结果保存到本地缓存，同时返回给客户机。<br>为了提供DNS的查询效率，减少因特网上的DNS查询报文数量，在域名服务器中广泛地使用了高速缓存，当一个DNS服务器接收到DNS查询结果是，它能将该DNS信息缓存在高速缓存中。这样，当另一个相同的域名查询到大概DNS服务器是，该服务器就能够直接提供所要求的IP地址，而不需要再去向其他DNS服务器询问了，因为主机名和IP地址之间的映射不是永久的，所以DNS服务器将在一段时间后丢弃高速缓存中的信息。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>南京友记</title>
      <link href="2021/05/03/%E2%80%9C%E5%8D%97%E4%BA%AC%E5%8F%8B%E8%AE%B0-%E6%9D%8E%E5%AE%B6%E9%A6%A8%E2%80%9D/"/>
      <url>2021/05/03/%E2%80%9C%E5%8D%97%E4%BA%AC%E5%8F%8B%E8%AE%B0-%E6%9D%8E%E5%AE%B6%E9%A6%A8%E2%80%9D/</url>
      
        <content type="html"><![CDATA[<p> 这次来到了南京，见到了那个有趣的女生。我还记得最早的印象那应该是个非常高冷的女孩，因为处理好和玩嗨了的朋友们的事宜，我还是迟到了，不得不说五一真就堵得离谱。（再提一嘴，短短一公里我打了两辆车，中间遇到一个可怜的老人，下车给予了些力所能及的帮助，好家伙，一回头打的车溜了。。。害）。当时真害怕女孩子不高兴，我自己本身就很讨厌男孩子不守时。匆匆到了大厦，人家已经把一切都准备好了，惭愧惭愧。当时疲乏感涌上心头，实在没有胃口，但那时她点的饭菜确实好看又精致。因为是同乡，见到还是倍感亲切的，聊了会吧。</p><p> 吃完饭就要出去逛啦，老实说走出去的那瞬间我一下子超级饿，就让她带着我走走吧，她应该比较了解的，只是漫步，就能感觉到南京这个城市独特的韵味。记得她说她的朋友去过南京都说，杭州，狗都不去。 嗯，她是对的。        一路上她都在聊吃吃吃，反正她也看不到，我就直说了，我居然一直觉得她就是个樱桃小嘴的淑女，喝半碗水就会饱的那种，然后她打开小红书给我介绍吃的知识，知道她说自己可以生吃n个汉堡，一瞬间，形象崩塌了。可能这就是美女吧。</p><p> （她小红书给我留下最深刻的印象就是各种吃的，饕餮派美少女就是这样吧）</p><p> 再然后就是经典中的经典，我这个臭直男硬要拉着人家喝咖啡，典中典吧，结果到了，找了一家评分貌似不错的咖啡店，最后把整个金鹰都找遍了也没找到，我怀疑店开到了天上。 好吧，去一楼的咖啡店随便喝点。 对不起，咖啡售罄，行吧行吧，红茶也行。好在小姑娘喜欢甜品，巧的是我也喜欢，吃的算开心，也被教育了很多awesome的吃法，确实，这个女孩子很会吃却还是这么好看，这么瘦，我真的很酸。下辈子我也要做女的。</p><p> 时间差不多了也该回去了，在地铁上她说她很喜欢周杰伦。我快哭了，知己，不必多说，尽在不言中。（能唱出冷门的反钟的可不多）。到了她的学校，周围好多吃的，其实我也很饿，但是我这里故作矜持了啊，下次不会了，后来饿死了😭😭😭。偷偷溜进去她的学校玩了一圈，有点午夜探险的味道，有趣且生动。带着我玩了一圈，确实还是蛮有意思的。</p><p> 之后她回寝室后我因为朋友的和学校的事情很快溜回去了。很高兴可以认识这样有趣可爱的人，（确实很能吃，我没觉得她对吃的叙述有任何夸张）</p><p> 谢谢，李家馨同学为我这次的旅游增添了一丝乐活的色彩。</p><pre><code>                                                                 对南京有趣的人的记录 完。</code></pre>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>南京之旅-中山陵</title>
      <link href="2021/05/01/%E5%8D%97%E4%BA%AC%E4%B9%8B%E6%97%85-episode-1/"/>
      <url>2021/05/01/%E5%8D%97%E4%BA%AC%E4%B9%8B%E6%97%85-episode-1/</url>
      
        <content type="html"><![CDATA[<p>北伐之后，孙文灵柩于南京“奉安”。此时章太炎做一联挽孙：</p><blockquote><p>“洪以甲子灭，公以乙丑殂，六十年间成败异；生当中山称，死傍孝陵葬，一匡天下<strong>古今同</strong>”。</p></blockquote><p>联中称孙文功绩高过洪秀全、而与朱元璋相同（朱洪均为孙文偶像），当为赞美孙之功业。然时人均以为“微言大义”，为何？</p><p>古今未变罢了</p><p>最后我也来到了中山陵。去掉五一特别的交通红利和人口激励，脱离种种困顿和老张漫步在林子中，有一种从压抑已久的环境中一下子突破的快感。在门口我作为外来者一片茫然，只是进入误打误撞罢了，深深在陷在林子中只觉得曲径通幽，满绿连天的碧树，最开始老实说并无感受到历史的底蕴。</p><p>慢慢地向前，一个一个景点浮现在眼前，有一种江南园林浮光掠影的味道，景致都在转角处显现，蓦然回首，那人却在灯火阑珊处，形容景致也并不差。</p><p>接下来就是爬一爬那高塔，很累很高，嗯，有趣。</p><p>我就是这么词穷。好了，看完孙先生的陵园今天的景点考察告一段落。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>计算机文件系统</title>
      <link href="2021/04/24/%E2%80%9C%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E2%80%9D/"/>
      <url>2021/04/24/%E2%80%9C%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E2%80%9D/</url>
      
        <content type="html"><![CDATA[<p><img src="https://pic2.zhimg.com/v2-8e32ced15780434b197e7bebe24e2671_r.jpg" alt="img"></p><hr><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>不多 BB，直接上「硬菜」。</p><p><img src="https://pic1.zhimg.com/v2-9a85e905f1d5d649bbd6b5524d8b2954_r.jpg" alt="img"></p><hr><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="文件系统的基本组成"><a href="#文件系统的基本组成" class="headerlink" title="文件系统的基本组成"></a>文件系统的基本组成</h3><p>文件系统是操作系统中负责管理持久数据的子系统，说简单点，就是负责把用户的文件存到磁盘硬件中，因为即使计算机断电了，磁盘里的数据并不会丢失，所以可以持久化的保存文件。</p><p>文件系统的基本数据单位是文件，它的目的是对磁盘上的文件进行组织管理，那组织的方式不同，就会形成不同的文件系统。</p><p>Linux 最经典的一句话是：「<strong>一切皆文件</strong>」，不仅普通的文件和目录，就连块设备、管道、socket 等，也都是统一交给文件系统管理的。</p><p>Linux 文件系统会为每个文件分配两个数据结构：<strong>索引节点（*index node*）和目录项（*directory entry*）</strong>，它们主要用来记录文件的元信息和目录层次结构。</p><ul><li>索引节点，也就是 <em>inode</em>，用来记录文件的元信息，比如 inode 编号、文件大小、访问权限、创建时间、修改时间、<strong>数据在磁盘的位置</strong>等等。索引节点是文件的<strong>唯一</strong>标识，它们之间一一对应，也同样都会被存储在硬盘中，所以<strong>索引节点同样占用磁盘空间</strong>。</li><li>目录项，也就是 <em>dentry</em>，用来记录文件的名字、<strong>索引节点指针</strong>以及与其他目录项的层级关联关系。多个目录项关联起来，就会形成目录结构，但它与索引节点不同的是，<strong>目录项是由内核维护的一个数据结构，不存放于磁盘，而是缓存在内存</strong>。</li></ul><p>由于索引节点唯一标识一个文件，而目录项记录着文件的名，所以目录项和索引节点的关系是多对一，也就是说，一个文件可以有多个别字。比如，硬链接的实现就是多个目录项中的索引节点指向同一个文件。</p><p>注意，目录也是文件，也是用索引节点唯一标识，和普通文件不同的是，普通文件在磁盘里面保存的是文件数据，而目录文件在磁盘里面保存子目录或文件。</p><blockquote><p>目录项和目录是一个东西吗？</p></blockquote><p>虽然名字很相近，但是它们不是一个东西，目录是个文件，持久化存储在磁盘，而目录项是内核一个数据结构，缓存在内存。</p><p>如果查询目录频繁从磁盘读，效率会很低，所以内核会把已经读过的目录用目录项这个数据结构缓存在内存，下次再次读到相同的目录时，只需从内存读就可以，大大提高了文件系统的效率。</p><p>注意，目录项这个数据结构不只是表示目录，也是可以表示文件的。</p><blockquote><p>那文件数据是如何存储在磁盘的呢？</p></blockquote><p>磁盘读写的最小单位是<strong>扇区</strong>，扇区的大小只有 <code>512B</code> 大小，很明显，如果每次读写都以这么小为单位，那这读写的效率会非常低。</p><p>所以，文件系统把多个扇区组成了一个<strong>逻辑块</strong>，每次读写的最小单位就是逻辑块（数据块），Linux 中的逻辑块大小为 <code>4KB</code>，也就是一次性读写 8 个扇区，这将大大提高了磁盘的读写的效率。</p><p>以上就是索引节点、目录项以及文件数据的关系，下面这个图就很好的展示了它们之间的关系：</p><p><img src="https://pic2.zhimg.com/v2-9d77e25913894df26b0374ceae25c605_r.jpg" alt="img"></p><p>索引节点是存储在硬盘上的数据，那么为了加速文件的访问，通常会把索引节点加载到内存中。</p><p>另外，磁盘进行格式化的时候，会被分成三个存储区域，分别是超级块、索引节点区和数据块区。 - <em>超级块</em>，用来存储文件系统的详细信息，比如块个数、块大小、空闲块等等。 - <em>索引节点区</em>，用来存储索引节点； - <em>数据块区</em>，用来存储文件或目录数据；</p><p>我们不可能把超级块和索引节点区全部加载到内存，这样内存肯定撑不住，所以只有当需要使用的时候，才将其加载进内存，它们加载进内存的时机是不同的：</p><ul><li>超级块：当文件系统挂载时进入内存；</li><li>索引节点区：当文件被访问时进入内存；</li></ul><hr><h3 id="虚拟文件系统"><a href="#虚拟文件系统" class="headerlink" title="虚拟文件系统"></a>虚拟文件系统</h3><p>文件系统的种类众多，而操作系统希望<strong>对用户提供一个统一的接口</strong>，于是在用户层与文件系统层引入了中间层，这个中间层就称为<strong>虚拟文件系统（*Virtual File System，VFS*）。</strong></p><p>VFS 定义了一组所有文件系统都支持的数据结构和标准接口，这样程序员不需要了解文件系统的工作原理，只需要了解 VFS 提供的统一接口即可。</p><p>在 Linux 文件系统中，用户空间、系统调用、虚拟机文件系统、缓存、文件系统以及存储之间的关系如下图：</p><p><img src="https://pic3.zhimg.com/v2-b92499b17ed11bc279689ecdb6efb4b6_r.jpg" alt="img"></p><p>Linux 支持的文件系统也不少，根据存储位置的不同，可以把文件系统分为三类：</p><ul><li><em>磁盘的文件系统</em>，它是直接把数据存储在磁盘中，比如 Ext 2/3/4、XFS 等都是这类文件系统。</li><li><em>内存的文件系统</em>，这类文件系统的数据不是存储在硬盘的，而是占用内存空间，我们经常用到的 <code>/proc</code> 和 <code>/sys</code> 文件系统都属于这一类，读写这类文件，实际上是读写内核中相关的数据数据。</li><li><em>网络的文件系统</em>，用来访问其他计算机主机数据的文件系统，比如 NFS、SMB 等等。</li></ul><p>文件系统首先要先挂载到某个目录才可以正常使用，比如 Linux 系统在启动时，会把文件系统挂载到根目录。</p><hr><h3 id="文件的使用"><a href="#文件的使用" class="headerlink" title="文件的使用"></a>文件的使用</h3><p>我们从用户角度来看文件的话，就是我们要怎么使用文件？首先，我们得通过系统调用来打开一个文件。</p><p><img src="https://pic1.zhimg.com/v2-bb6dc369fbf16afbdb088c6c7c26d9cc_r.jpg" alt="img"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fd = open(name, flag); # 打开文件</span><br><span class="line">...</span><br><span class="line">write(fd,...);         # 写数据</span><br><span class="line">...</span><br><span class="line">close(fd);             # 关闭文件</span><br></pre></td></tr></table></figure><p>上面简单的代码是读取一个文件的过程： - 首先用 <code>open</code> 系统调用打开文件，<code>open</code> 的参数中包含文件的路径名和文件名。 - 使用 <code>write</code> 写数据，其中 <code>write</code> 使用 <code>open</code> 所返回的<strong>文件描述符</strong>，并不使用文件名作为参数。 - 使用完文件后，要用 <code>close</code> 系统调用关闭文件，避免资源的泄露。</p><p>我们打开了一个文件后，操作系统会跟踪进程打开的所有文件，所谓的跟踪呢，就是操作系统为每个进程维护一个打开文件表，文件表里的每一项代表「<strong>文件描述符</strong>」，所以说文件描述符是打开文件的标识。</p><p><img src="https://pic3.zhimg.com/80/v2-4d1f24d7102933f32a560a1cbdfce6da_1440w.jpg" alt="img"></p><p>操作系统在打开文件表中维护着打开文件的状态和信息： - 文件指针：系统跟踪上次读写位置作为当前文件位置指针，这种指针对打开文件的某个进程来说是唯一的； - 文件打开计数器：文件关闭时，操作系统必须重用其打开文件表条目，否则表内空间不够用。因为多个进程可能打开同一个文件，所以系统在删除打开文件条目之前，必须等待最后一个进程关闭文件，该计数器跟踪打开和关闭的数量，当该计数为 0 时，系统关闭文件，删除该条目； - 文件磁盘位置：绝大多数文件操作都要求系统修改文件数据，该信息保存在内存中，以免每个操作都从磁盘中读取； - 访问权限：每个进程打开文件都需要有一个访问模式（创建、只读、读写、添加等），该信息保存在进程的打开文件表中，以便操作系统能允许或拒绝之后的 I/O 请求；</p><p>在用户视角里，文件就是一个持久化的数据结构，但操作系统并不会关心你想存在磁盘上的任何的数据结构，操作系统的视角是如何把文件数据和磁盘块对应起来。</p><p>所以，用户和操作系统对文件的读写操作是有差异的，用户习惯以字节的方式读写文件，而操作系统则是以数据块来读写文件，那屏蔽掉这种差异的工作就是文件系统了。</p><p>我们来分别看一下，读文件和写文件的过程：</p><ul><li>当用户进程从文件读取 1 个字节大小的数据时，文件系统则需要获取字节所在的数据块，再返回数据块对应的用户进程所需的数据部分。</li><li>当用户进程把 1 个字节大小的数据写进文件时，文件系统则找到需要写入数据的数据块的位置，然后修改数据块中对应的部分，最后再把数据块写回磁盘。</li></ul><p>所以说，<strong>文件系统的基本操作单位是数据块</strong>。</p><hr><h3 id="文件的存储"><a href="#文件的存储" class="headerlink" title="文件的存储"></a>文件的存储</h3><p>文件的数据是要存储在硬盘上面的，数据在磁盘上的存放方式，就像程序在内存中存放的方式那样，有以下两种：</p><ul><li>连续空间存放方式</li><li>非连续空间存放方式</li></ul><p>其中，非连续空间存放方式又可以分为「链表方式」和「索引方式」。</p><p>不同的存储方式，有各自的特点，重点是要分析它们的存储效率和读写性能，接下来分别对每种存储方式说一下。</p><h3 id="连续空间存放方式"><a href="#连续空间存放方式" class="headerlink" title="连续空间存放方式"></a>连续空间存放方式</h3><p>连续空间存放方式顾名思义，<strong>文件存放在磁盘「连续的」物理空间中</strong>。这种模式下，文件的数据都是紧密相连，<strong>读写效率很高</strong>，因为一次磁盘寻道就可以读出整个文件。</p><p>使用连续存放的方式有一个前提，必须先知道一个文件的大小，这样文件系统才会根据文件的大小在磁盘上找到一块连续的空间分配给文件。</p><p>所以，<strong>文件头里需要指定「起始块的位置」和「长度」</strong>，有了这两个信息就可以很好的表示文件存放方式是一块连续的磁盘空间。</p><p>注意，此处说的文件头，就类似于 Linux 的 inode。</p><p><img src="https://pic4.zhimg.com/v2-7fc9cbf9c253d0ee84af8f61c605d50f_r.jpg" alt="img"></p><p>连续空间存放的方式虽然读写效率高，<strong>但是有「磁盘空间碎片」和「文件长度不易扩展」的缺陷。</strong></p><p>如下图，如果文件 B 被删除，磁盘上就留下一块空缺，这时，如果新来的文件小于其中的一个空缺，我们就可以将其放在相应空缺里。但如果该文件的大小大于所有的空缺，但却小于空缺大小之和，则虽然磁盘上有足够的空缺，但该文件还是不能存放。当然了，我们可以通过将现有文件进行挪动来腾出空间以容纳新的文件，但是这个在磁盘挪动文件是非常耗时，所以这种方式不太现实。</p><p><img src="https://pic1.zhimg.com/v2-5e0b69486a4e42554941c93a44d538e0_r.jpg" alt="img"></p><p>另外一个缺陷是文件长度扩展不方便，例如上图中的文件 A 要想扩大一下，需要更多的磁盘空间，唯一的办法就只能是挪动的方式，前面也说了，这种方式效率是非常低的。</p><p>那么有没有更好的方式来解决上面的问题呢？答案当然有，既然连续空间存放的方式不太行，那么我们就改变存放的方式，使用非连续空间存放方式来解决这些缺陷。</p><h3 id="非连续空间存放方式"><a href="#非连续空间存放方式" class="headerlink" title="非连续空间存放方式"></a>非连续空间存放方式</h3><p>非连续空间存放方式分为「链表方式」和「索引方式」。</p><blockquote><p>我们先来看看链表的方式。</p></blockquote><p>链表的方式存放是<strong>离散的，不用连续的</strong>，于是就可以<strong>消除磁盘碎片</strong>，可大大提高磁盘空间的利用率，同时<strong>文件的长度可以动态扩展</strong>。根据实现的方式的不同，链表可分为「<strong>隐式链表</strong>」和「<strong>显式链接</strong>」两种形式。</p><p>文件要以「<strong>隐式链表</strong>」的方式存放的话，<strong>实现的方式是文件头要包含「第一块」和「最后一块」的位置，并且每个数据块里面留出一个指针空间，用来存放下一个数据块的位置</strong>，这样一个数据块连着一个数据块，从链头开是就可以顺着指针找到所有的数据块，所以存放的方式可以是不连续的。</p><p><img src="https://pic2.zhimg.com/v2-b3d581a3d561f3386a497d5622180c81_r.jpg" alt="img"></p><p>隐式链表的存放方式的<strong>缺点在于无法直接访问数据块，只能通过指针顺序访问文件，以及数据块指针消耗了一定的存储空间</strong>。隐式链接分配的<strong>稳定性较差</strong>，系统在运行过程中由于软件或者硬件错误<strong>导致链表中的指针丢失或损坏，会导致文件数据的丢失。</strong></p><p>如果取出每个磁盘块的指针，把它放在内存的一个表中，就可以解决上述隐式链表的两个不足。那么，这种实现方式是「<strong>显式链接</strong>」，它指<strong>把用于链接文件各数据块的指针，显式地存放在内存的一张链接表中</strong>，该表在整个磁盘仅设置一张，<strong>每个表项中存放链接指针，指向下一个数据块号</strong>。</p><p>对于显式链接的工作方式，我们举个例子，文件 A 依次使用了磁盘块 4、7、2、10 和 12 ，文件 B 依次使用了磁盘块 6、3、11 和 14 。利用下图中的表，可以从第 4 块开始，顺着链走到最后，找到文件 A 的全部磁盘块。同样，从第 6 块开始，顺着链走到最后，也能够找出文件 B 的全部磁盘块。最后，这两个链都以一个不属于有效磁盘编号的特殊标记（如 -1 ）结束。内存中的这样一个表格称为<strong>文件分配表（*File Allocation Table，FAT*）</strong>。</p><p><img src="https://pic3.zhimg.com/v2-848b55299135f1775cb9fa5e6f9f9272_r.jpg" alt="img"></p><p>由于查找记录的过程是在内存中进行的，因而不仅显著地<strong>提高了检索速度</strong>，而且<strong>大大减少了访问磁盘的次数</strong>。但也正是整个表都存放在内存中的关系，它的主要的缺点是<strong>不适用于大磁盘</strong>。</p><p>比如，对于 200GB 的磁盘和 1KB 大小的块，这张表需要有 2 亿项，每一项对应于这 2 亿个磁盘块中的一个块，每项如果需要 4 个字节，那这张表要占用 800MB 内存，很显然 FAT 方案对于大磁盘而言不太合适。</p><blockquote><p>接下来，我们来看看索引的方式。</p></blockquote><p>链表的方式解决了连续分配的磁盘碎片和文件动态扩展的问题，但是不能有效支持直接访问（FAT除外），索引的方式可以解决这个问题。</p><p>索引的实现是为每个文件创建一个「<strong>索引数据块</strong>」，里面存放的是<strong>指向文件数据块的指针列表</strong>，说白了就像书的目录一样，要找哪个章节的内容，看目录查就可以。</p><p>另外，<strong>文件头需要包含指向「索引数据块」的指针</strong>，这样就可以通过文件头知道索引数据块的位置，再通过索引数据块里的索引信息找到对应的数据块。</p><p>创建文件时，索引块的所有指针都设为空。当首次写入第 i 块时，先从空闲空间中取得一个块，再将其地址写到索引块的第 i 个条目。</p><p><img src="https://pic3.zhimg.com/v2-1e6d2ef6d8782117779143843798b79e_r.jpg" alt="img"></p><p>索引的方式优点在于： - 文件的创建、增大、缩小很方便； - 不会有碎片的问题； - 支持顺序读写和随机读写；</p><p>由于索引数据也是存放在磁盘块的，如果文件很小，明明只需一块就可以存放的下，但还是需要额外分配一块来存放索引数据，所以缺陷之一就是存储索引带来的开销。</p><p>如果文件很大，大到一个索引数据块放不下索引信息，这时又要如何处理大文件的存放呢？我们可以通过组合的方式，来处理大文件的存。</p><p>先来看看链表 + 索引的组合，这种组合称为「<strong>链式索引块</strong>」，它的实现方式是<strong>在索引数据块留出一个存放下一个索引数据块的指针</strong>，于是当一个索引数据块的索引信息用完了，就可以通过指针的方式，找到下一个索引数据块的信息。那这种方式也会出现前面提到的链表方式的问题，万一某个指针损坏了，后面的数据也就会无法读取了。</p><p><img src="https://pic3.zhimg.com/v2-ede534663e1c19169eb40cbe01384da2_r.jpg" alt="img"></p><p>还有另外一种组合方式是索引 + 索引的方式，这种组合称为「<strong>多级索引块</strong>」，实现方式是<strong>通过一个索引块来存放多个索引数据块</strong>，一层套一层索引，像极了俄罗斯套娃是吧。</p><p><img src="https://pic1.zhimg.com/v2-fb7d558d7b1d2d48fa4544adbead57bc_r.jpg" alt="img"></p><h3 id="Unix-文件的实现方式"><a href="#Unix-文件的实现方式" class="headerlink" title="Unix 文件的实现方式"></a>Unix 文件的实现方式</h3><p>我们先把前面提到的文件实现方式，做个比较：</p><p><img src="https://pic4.zhimg.com/v2-e01c7af752461c0794a10f383dbe465b_r.jpg" alt="img"></p><p>那早期 Unix 文件系统是组合了前面的文件存放方式的优点，如下图：</p><p><img src="https://pic4.zhimg.com/v2-0c16919bcad17d1391f162e0363229b7_r.jpg" alt="img"></p><p>它是根据文件的大小，存放的方式会有所变化：</p><ul><li>如果存放文件所需的数据块小于 10 块，则采用直接查找的方式；</li><li>如果存放文件所需的数据块超过 10 块，则采用一级间接索引方式；</li><li>如果前面两种方式都不够存放大文件，则采用二级间接索引方式；</li><li>如果二级间接索引也不够存放大文件，这采用三级间接索引方式；</li></ul><p>那么，文件头（<em>Inode</em>）就需要包含 13 个指针： - 10 个指向数据块的指针； - 第 11 个指向索引块的指针； - 第 12 个指向二级索引块的指针； - 第 13 个指向三级索引块的指针；</p><p>所以，这种方式能很灵活地支持小文件和大文件的存放： - 对于小文件使用直接查找的方式可减少索引数据块的开销； - 对于大文件则以多级索引的方式来支持，所以大文件在访问数据块时需要大量查询；</p><p>这个方案就用在了 Linux Ext 2/3 文件系统里，虽然解决大文件的存储，但是对于大文件的访问，需要大量的查询，效率比较低。</p><p>为了解决这个问题，Ext 4 做了一定的改变，具体怎么解决的，本文就不展开了。</p><hr><h3 id="空闲空间管理"><a href="#空闲空间管理" class="headerlink" title="空闲空间管理"></a>空闲空间管理</h3><p>前面说到的文件的存储是针对已经被占用的数据块组织和管理，接下来的问题是，如果我要保存一个数据块，我应该放在硬盘上的哪个位置呢？难道需要将所有的块扫描一遍，找个空的地方随便放吗？</p><p>那这种方式效率就太低了，所以针对磁盘的空闲空间也是要引入管理的机制，接下来介绍几种常见的方法：</p><ul><li>空闲表法</li><li>空闲链表法</li><li>位图法</li></ul><h3 id="空闲表法"><a href="#空闲表法" class="headerlink" title="空闲表法"></a>空闲表法</h3><p>空闲表法就是为所有空闲空间建立一张表，表内容包括空闲区的第一个块号和该空闲区的块个数，注意，这个方式是连续分配的。如下图：</p><p><img src="https://pic3.zhimg.com/v2-1ec1e7e0b313a92e0028691ae97c9766_r.jpg" alt="img"></p><p>当请求分配磁盘空间时，系统依次扫描空闲表里的内容，直到找到一个合适的空闲区域为止。当用户撤销一个文件时，系统回收文件空间。这时，也需顺序扫描空闲表，寻找一个空闲表条目并将释放空间的第一个物理块号及它占用的块数填到这个条目中。</p><p>这种方法仅当有少量的空闲区时才有较好的效果。因为，如果存储空间中有着大量的小的空闲区，则空闲表变得很大，这样查询效率会很低。另外，这种分配技术适用于建立连续文件。</p><h3 id="空闲链表法"><a href="#空闲链表法" class="headerlink" title="空闲链表法"></a>空闲链表法</h3><p>我们也可以使用「链表」的方式来管理空闲空间，每一个空闲块里有一个指针指向下一个空闲块，这样也能很方便的找到空闲块并管理起来。如下图：</p><p><img src="https://pic3.zhimg.com/v2-a14c65a4ec2fbb470fba728b818a6d22_r.jpg" alt="img"></p><p>当创建文件需要一块或几块时，就从链头上依次取下一块或几块。反之，当回收空间时，把这些空闲块依次接到链头上。</p><p>这种技术只要在主存中保存一个指针，令它指向第一个空闲块。其特点是简单，但不能随机访问，工作效率低，因为每当在链上增加或移动空闲块时需要做很多 I/O 操作，同时数据块的指针消耗了一定的存储空间。</p><p>空闲表法和空闲链表法都不适合用于大型文件系统，因为这会使空闲表或空闲链表太大。</p><h3 id="位图法"><a href="#位图法" class="headerlink" title="位图法"></a>位图法</h3><p>位图是利用二进制的一位来表示磁盘中一个盘块的使用情况，磁盘上所有的盘块都有一个二进制位与之对应。</p><p>当值为 0 时，表示对应的盘块空闲，值为 1 时，表示对应的盘块已分配。它形式如下：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1111110011111110001110110111111100111 ...</span><br></pre></td></tr></table></figure><p>在 Linux 文件系统就采用了位图的方式来管理空闲空间，不仅用于数据空闲块的管理，还用于 inode 空闲块的管理，因为 inode 也是存储在磁盘的，自然也要有对其管理。</p><hr><h3 id="文件系统的结构"><a href="#文件系统的结构" class="headerlink" title="文件系统的结构"></a>文件系统的结构</h3><p>前面提到 Linux 是用位图的方式管理空闲空间，用户在创建一个新文件时，Linux 内核会通过 inode 的位图找到空闲可用的 inode，并进行分配。要存储数据时，会通过块的位图找到空闲的块，并分配，但仔细计算一下还是有问题的。</p><p>数据块的位图是放在磁盘块里的，假设是放在一个块里，一个块 4K，每位表示一个数据块，共可以表示 <code>4 * 1024 * 8 = 2^15</code> 个空闲块，由于 1 个数据块是 4K 大小，那么最大可以表示的空间为 <code>2^15 * 4 * 1024 = 2^27</code> 个 byte，也就是 128M。</p><p>也就是说按照上面的结构，如果采用「一个块的位图 + 一系列的块」，外加「一个块的 inode 的位图 + 一系列的 inode 的结构」能表示的最大空间也就 128M，这太少了，现在很多文件都比这个大。</p><p>在 Linux 文件系统，把这个结构称为一个<strong>块组</strong>，那么有 N 多的块组，就能够表示 N 大的文件。</p><p>下图给出了 Linux Ext2 整个文件系统的结构和块组的内容，文件系统都由大量块组组成，在硬盘上相继排布：</p><p><img src="https://pic2.zhimg.com/v2-d9e36f97b24b2a7f760a81d0b095c36d_r.jpg" alt="img"></p><p>最前面的第一个块是引导块，在系统启动时用于启用引导，接着后面就是一个一个连续的块组了，块组的内容如下： - <em>超级块</em>，包含的是文件系统的重要信息，比如 inode 总个数、块总个数、每个块组的 inode 个数、每个块组的块个数等等。 - <em>块组描述符</em>，包含文件系统中各个块组的状态，比如块组中空闲块和 inode 的数目等，每个块组都包含了文件系统中「所有块组的组描述符信息」。 - <em>数据位图和 inode 位图</em>， 用于表示对应的数据块或 inode 是空闲的，还是被使用中。 - <em>inode 列表</em>，包含了块组中所有的 inode，inode 用于保存文件系统中与各个文件和目录相关的所有元数据。 - <em>数据块</em>，包含文件的有用数据。</p><p>你可以会发现每个块组里有很多重复的信息，比如<strong>超级块和块组描述符表，这两个都是全局信息，而且非常的重要</strong>，这么做是有两个原因： - 如果系统崩溃破坏了超级块或块组描述符，有关文件系统结构和内容的所有信息都会丢失。如果有冗余的副本，该信息是可能恢复的。 - 通过使文件和管理数据尽可能接近，减少了磁头寻道和旋转，这可以提高文件系统的性能。</p><p>不过，Ext2 的后续版本采用了稀疏技术。该做法是，超级块和块组描述符表不再存储到文件系统的每个块组中，而是只写入到块组 0、块组 1 和其他 ID 可以表示为 3、 5、7 的幂的块组中。</p><hr><h3 id="目录的存储"><a href="#目录的存储" class="headerlink" title="目录的存储"></a>目录的存储</h3><p>在前面，我们知道了一个普通文件是如何存储的，但还有一个特殊的文件，经常用到的目录，它是如何保存的呢？</p><p>基于 Linux 一切皆文件的设计思想，目录其实也是个文件，你甚至可以通过 <code>vim</code> 打开它，它也有 inode，inode 里面也是指向一些块。</p><p>和普通文件不同的是，<strong>普通文件的块里面保存的是文件数据，而目录文件的块里面保存的是目录里面一项一项的文件信息。</strong></p><p>在目录文件的块中，最简单的保存格式就是<strong>列表</strong>，就是一项一项地将目录下的文件信息（如文件名、文件 inode、文件类型等）列在表里。</p><p>列表中每一项就代表该目录下的文件的文件名和对应的 inode，通过这个 inode，就可以找到真正的文件。</p><p><img src="https://pic1.zhimg.com/v2-89f1e2f2d2a2cb232920d2df16a5f3f4_r.jpg" alt="img"></p><p>通常，第一项是「<code>.</code>」，表示当前目录，第二项是「<code>..</code>」，表示上一级目录，接下来就是一项一项的文件名和 inode。</p><p>如果一个目录有超级多的文件，我们要想在这个目录下找文件，按照列表一项一项的找，效率就不高了。</p><p>于是，保存目录的格式改成<strong>哈希表</strong>，对文件名进行哈希计算，把哈希值保存起来，如果我们要查找一个目录下面的文件名，可以通过名称取哈希。如果哈希能够匹配上，就说明这个文件的信息在相应的块里面。</p><p>Linux 系统的 ext 文件系统就是采用了哈希表，来保存目录的内容，这种方法的优点是查找非常迅速，插入和删除也较简单，不过需要一些预备措施来避免哈希冲突。</p><p>目录查询是通过在磁盘上反复搜索完成，需要不断地进行 I/O 操作，开销较大。所以，为了减少 I/O 操作，把当前使用的文件目录缓存在内存，以后要使用该文件时只要在内存中操作，从而降低了磁盘操作次数，提高了文件系统的访问速度。</p><hr><h3 id="软链接和硬链接"><a href="#软链接和硬链接" class="headerlink" title="软链接和硬链接"></a>软链接和硬链接</h3><p>有时候我们希望给某个文件取个别名，那么在 Linux 中可以通过<strong>硬链接（*Hard Link*）</strong> 和<strong>软链接（*Symbolic Link*）</strong> 的方式来实现，它们都是比较特殊的文件，但是实现方式也是不相同的。</p><p>硬链接是<strong>多个目录项中的「索引节点」指向一个文件</strong>，也就是指向同一个 inode，但是 inode 是不可能跨越文件系统的，每个文件系统都有各自的 inode 数据结构和列表，所以<strong>硬链接是不可用于跨文件系统的</strong>。由于多个目录项都是指向一个 inode，那么<strong>只有删除文件的所有硬链接以及源文件时，系统才会彻底删除该文件。</strong></p><p><img src="https://pic4.zhimg.com/v2-7cf8cec396a66dca2dd1fcd6dadab537_r.jpg" alt="img"></p><p>软链接相当于重新创建一个文件，这个文件有<strong>独立的 inode</strong>，但是这个<strong>文件的内容是另外一个文件的路径</strong>，所以访问软链接的时候，实际上相当于访问到了另外一个文件，所以<strong>软链接是可以跨文件系统的</strong>，甚至<strong>目标文件被删除了，链接文件还是在的，只不过指向的文件找不到了而已。</strong></p><p><img src="https://pic3.zhimg.com/v2-5606413e1b5d2c727399711d347617a2_r.jpg" alt="img"></p><hr><h3 id="文件-I-O"><a href="#文件-I-O" class="headerlink" title="文件 I/O"></a>文件 I/O</h3><p>文件的读写方式各有千秋，对于文件的 I/O 分类也非常多，常见的有</p><ul><li>缓冲与非缓冲 I/O</li><li>直接与非直接 I/O</li><li>阻塞与非阻塞 I/O VS 同步与异步 I/O</li></ul><p>接下来，分别对这些分类讨论讨论。</p><h3 id="缓冲与非缓冲-I-O"><a href="#缓冲与非缓冲-I-O" class="headerlink" title="缓冲与非缓冲 I/O"></a>缓冲与非缓冲 I/O</h3><p>文件操作的标准库是可以实现数据的缓存，那么<strong>根据「是否利用标准库缓冲」，可以把文件 I/O 分为缓冲 I/O 和非缓冲 I/O</strong>： - 缓冲 I/O，利用的是标准库的缓存实现文件的加速访问，而标准库再通过系统调用访问文件。 - 非缓冲 I/O，直接通过系统调用访问文件，不经过标准库缓存。</p><p>这里所说的「缓冲」特指标准库内部实现的缓冲。</p><p>比方说，很多程序遇到换行时才真正输出，而换行前的内容，其实就是被标准库暂时缓存了起来，这样做的目的是，减少系统调用的次数，毕竟系统调用是有 CPU 上下文切换的开销的。</p><h3 id="直接与非直接-I-O"><a href="#直接与非直接-I-O" class="headerlink" title="直接与非直接 I/O"></a>直接与非直接 I/O</h3><p>我们都知道磁盘 I/O 是非常慢的，所以 Linux 内核为了减少磁盘 I/O 次数，在系统调用后，会把用户数据拷贝到内核中缓存起来，这个内核缓存空间也就是「页缓存」，只有当缓存满足某些条件的时候，才发起磁盘 I/O 的请求。</p><p>那么，<strong>根据是「否利用操作系统的缓存」，可以把文件 I/O 分为直接 I/O 与非直接 I/O</strong>：</p><ul><li>直接 I/O，不会发生内核缓存和用户程序之间数据复制，而是直接经过文件系统访问磁盘。</li><li>非直接 I/O，读操作时，数据从内核缓存中拷贝给用户程序，写操作时，数据从用户程序拷贝给内核缓存，再由内核决定什么时候写入数据到磁盘。</li></ul><p>如果你在使用文件操作类的系统调用函数时，指定了 <code>O_DIRECT</code> 标志，则表示使用直接 I/O。如果没有设置过，默认使用的是非直接 I/O。</p><blockquote><p>如果用了非直接 I/O 进行写数据操作，内核什么情况下才会把缓存数据写入到磁盘？</p></blockquote><p>以下几种场景会触发内核缓存的数据写入磁盘： - 在调用 <code>write</code> 的最后，当发现内核缓存的数据太多的时候，内核会把数据写到磁盘上； - 用户主动调用 <code>sync</code>，内核缓存会刷到磁盘上； - 当内存十分紧张，无法再分配页面时，也会把内核缓存的数据刷到磁盘上； - 内核缓存的数据的缓存时间超过某个时间时，也会把数据刷到磁盘上；</p><h3 id="阻塞与非阻塞-I-O-VS-同步与异步-I-O"><a href="#阻塞与非阻塞-I-O-VS-同步与异步-I-O" class="headerlink" title="阻塞与非阻塞 I/O VS 同步与异步 I/O"></a>阻塞与非阻塞 I/O VS 同步与异步 I/O</h3><p>为什么把阻塞 / 非阻塞与同步与异步放一起说的呢？因为它们确实非常相似，也非常容易混淆，不过它们之间的关系还是有点微妙的。</p><p>先来看看<strong>阻塞 I/O</strong>，当用户程序执行 <code>read</code> ，线程会被阻塞，一直等到内核数据准备好，并把数据从内核缓冲区拷贝到应用程序的缓冲区中，当拷贝过程完成，<code>read</code> 才会返回。</p><p>注意，<strong>阻塞等待的是「内核数据准备好」和「数据从内核态拷贝到用户态」这两个过程</strong>。过程如下图：</p><p><img src="https://pic2.zhimg.com/v2-7f73fdcaca316aa0f12d77b6873785e5_r.jpg" alt="img"></p><p>知道了阻塞 I/O ，来看看<strong>非阻塞 I/O</strong>，非阻塞的 read 请求在数据未准备好的情况下立即返回，可以继续往下执行，此时应用程序不断轮询内核，直到数据准备好，内核将数据拷贝到应用程序缓冲区，<code>read</code> 调用才可以获取到结果。过程如下图：</p><p><img src="https://pic2.zhimg.com/v2-51e052e2beecef41da3aed3ebc2b80bd_r.jpg" alt="img"></p><p>注意，<strong>这里最后一次 read 调用，获取数据的过程，是一个同步的过程，是需要等待的过程。这里的同步指的是内核态的数据拷贝到用户程序的缓存区这个过程。</strong></p><p>举个例子，访问管道或 socket 时，如果设置了 <code>O_NONBLOCK</code> 标志，那么就表示使用的是非阻塞 I/O 的方式访问，而不做任何设置的话，默认是阻塞 I/O。</p><p>应用程序每次轮询内核的 I/O 是否准备好，感觉有点傻乎乎，因为轮询的过程中，应用程序啥也做不了，只是在循环。</p><p>为了解决这种傻乎乎轮询方式，于是 <strong>I/O 多路复用</strong>技术就出来了，如 select、poll，它是通过 I/O 事件分发，当内核数据准备好时，再以事件通知应用程序进行操作。</p><p>这个做法大大改善了应用进程对 CPU 的利用率，在没有被通知的情况下，应用进程可以使用 CPU 做其他的事情。</p><p>下图是使用 select I/O 多路复用过程。注意，<code>read</code> 获取数据的过程（数据从内核态拷贝到用户态的过程），也是一个<strong>同步的过程</strong>，需要等待：</p><p><img src="https://pic4.zhimg.com/v2-02cfbd8572026087fc9b8e946b4d98bf_r.jpg" alt="img"></p><p>实际上，无论是阻塞 I/O、非阻塞 I/O，还是基于非阻塞 I/O 的多路复用<strong>都是同步调用。因为它们在 read 调用时，内核将数据从内核空间拷贝到应用程序空间，过程都是需要等待的，也就是说这个过程是同步的，如果内核实现的拷贝效率不高，read 调用就会在这个同步过程中等待比较长的时间。</strong></p><p>而真正的<strong>异步 I/O</strong> 是「内核数据准备好」和「数据从内核态拷贝到用户态」这两个过程都不用等待。</p><p>当我们发起 <code>aio_read</code> 之后，就立即返回，内核自动将数据从内核空间拷贝到应用程序空间，这个拷贝过程同样是异步的，内核自动完成的，和前面的同步操作不一样，应用程序并不需要主动发起拷贝动作。过程如下图：</p><p><img src="https://pic4.zhimg.com/v2-b01988dd44a5edbe596a280d1c266033_r.jpg" alt="img"></p><p>下面这张图，总结了以上几种 I/O 模型：</p><p><img src="https://pic1.zhimg.com/v2-1e7c3779cdf820da751a4fb1c84a602c_r.jpg" alt="img"></p><p>在前面我们知道了，I/O 是分为两个过程的： 1. 数据准备的过程 2. 数据从内核空间拷贝到用户进程缓冲区的过程</p><p>阻塞 I/O 会阻塞在「过程 1 」和「过程 2」，而非阻塞 I/O 和基于非阻塞 I/O 的多路复用只会阻塞在「过程 2」，所以这三个都可以认为是同步 I/O。</p><p>异步 I/O 则不同，「过程 1 」和「过程 2 」都不会阻塞。</p><blockquote><p>用故事去理解这几种 I/O 模型</p></blockquote><p>举个你去饭堂吃饭的例子，你好比用户程序，饭堂好比操作系统。</p><p>阻塞 I/O 好比，你去饭堂吃饭，但是饭堂的菜还没做好，然后你就一直在那里等啊等，等了好长一段时间终于等到饭堂阿姨把菜端了出来（数据准备的过程），但是你还得继续等阿姨把菜（内核空间）打到你的饭盒里（用户空间），经历完这两个过程，你才可以离开。</p><p>非阻塞 I/O 好比，你去了饭堂，问阿姨菜做好了没有，阿姨告诉你没，你就离开了，过几十分钟，你又来饭堂问阿姨，阿姨说做好了，于是阿姨帮你把菜打到你的饭盒里，这个过程你是得等待的。</p><p>基于非阻塞的 I/O 多路复用好比，你去饭堂吃饭，发现有一排窗口，饭堂阿姨告诉你这些窗口都还没做好菜，等做好了再通知你，于是等啊等（<code>select</code> 调用中），过了一会阿姨通知你菜做好了，但是不知道哪个窗口的菜做好了，你自己看吧。于是你只能一个一个窗口去确认，后面发现 5 号窗口菜做好了，于是你让 5 号窗口的阿姨帮你打菜到饭盒里，这个打菜的过程你是要等待的，虽然时间不长。打完菜后，你自然就可以离开了。</p><p>异步 I/O 好比，你让饭堂阿姨将菜做好并把菜打到饭盒里后，把饭盒送到你面前，整个过程你都不需要任何等待。</p><hr>]]></content>
      
      
      <categories>
          
          <category> 计算机常识 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>幂级数的本质</title>
      <link href="2021/04/22/%E2%80%9C%E5%B9%82%E7%BA%A7%E6%95%B0%E7%9A%84%E6%9C%AC%E8%B4%A8%E2%80%9D/"/>
      <url>2021/04/22/%E2%80%9C%E5%B9%82%E7%BA%A7%E6%95%B0%E7%9A%84%E6%9C%AC%E8%B4%A8%E2%80%9D/</url>
      
        <content type="html"><![CDATA[<p>此文为转载。</p><h1 id="微积分-8-级数（幂级数）"><a href="#微积分-8-级数（幂级数）" class="headerlink" title="微积分-8.级数（幂级数）"></a>微积分-8.级数（幂级数）</h1><p><a href="https://www.zhihu.com/people/qian-chen-31"><img src="https://pic1.zhimg.com/v2-f3cd01b5d1e0f03071338b2e845ac0d1_xs.jpg?source=172ae18b" alt="钱辰"></a></p><h2 id="回到梦开始的地方"><a href="#回到梦开始的地方" class="headerlink" title="回到梦开始的地方"></a>回到梦开始的地方</h2><p>在一元函数微积分的世界中，我们沿着极限、导数、微分、积分的路已经走出了一段路。</p><p>这时候回头看我们在第一篇《从极限开始》中介绍的芝诺悖论，你是否还记得计算阿喀琉斯追赶上乌龟所需要的时间的表达式：</p><p><img src="https://www.zhihu.com/equation?tex=T=%5Cfrac%7B90%7D%7B10%7D+%5Cfrac%7B9%7D%7B10%7D+%5Cfrac%7B0.9%7D%7B10%7D+..." alt="[公式]"></p><p>显而易见的，这个求和算式中的每一项所组成的，是一个首项为9，公比为0.1的等比数列，其通项可写为：</p><p><img src="https://www.zhihu.com/equation?tex=a_n=9%5Ccdot+(0.1)%5E%7Bn-1%7D" alt="[公式]"></p><p>而所求时间 <img src="https://www.zhihu.com/equation?tex=T" alt="[公式]"> ，则是对这个数列的项数 <img src="https://www.zhihu.com/equation?tex=n%5Cto+%5Cinfty" alt="[公式]"> 时进行求和，即：</p><p><img src="https://www.zhihu.com/equation?tex=T=%5Csum_%7Bn=1%7D%5E%5Cinfty+a_n+" alt="[公式]"></p><p><strong>无穷数列的求和</strong>就是无穷级数，简称<strong>级数</strong>。</p><p>所以，级数，实际上就是再次借助极限的工具，将对数列的有限项求和推广到了无限项求和。因此我们可以说，积分是无限连续项的求和，级数则是无限离散项的求和。</p><p>接下来，有了级数的概念以后，我们就可以用它来解决芝诺没有想明白的地方：即无穷项求和的结果，到底是趋向无穷的不可得还是趋向一个确定的数，即讨论级数的敛散性。</p><hr><h2 id="级数的敛散性"><a href="#级数的敛散性" class="headerlink" title="级数的敛散性"></a>级数的敛散性</h2><p>就让我们先从非常熟悉的等比数列开始说起：</p><p>有等比数列，公比为 <img src="https://www.zhihu.com/equation?tex=q" alt="[公式]"> ，首项为 <img src="https://www.zhihu.com/equation?tex=a_1" alt="[公式]"> ，其中 <img src="https://www.zhihu.com/equation?tex=p,a_1%5Cneq0" alt="[公式]"> 且 <img src="https://www.zhihu.com/equation?tex=q%5Cneq+1" alt="[公式]"> ，则有通项：</p><p><img src="https://www.zhihu.com/equation?tex=a_n=a_1%5Ccdot+p%5E%7Bn-1%7D" alt="[公式]"></p><p>由等比数列的前 <img src="https://www.zhihu.com/equation?tex=n" alt="[公式]"> 项求和公式知：</p><p><img src="https://www.zhihu.com/equation?tex=S_n=a_1%5Ccdot+%5Cfrac%7B1-q%5En%7D%7B1-q%7D" alt="[公式]"></p><p>求解级数 <img src="https://www.zhihu.com/equation?tex=%5Csum_%7Bn=1%7D%5E%7B%5Cinfty%7Da_n" alt="[公式]"> ，实际上就是在求：</p><p><img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bn+%5Cto+%5Cinfty%7DS_n=a_1%5Ccdot+%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cfrac%7B1-q%5En%7D%7B1-q%7D" alt="[公式]"></p><p>可以看到：</p><p>若 <img src="https://www.zhihu.com/equation?tex=-1%3Cq%3C1" alt="[公式]"> ，则 <img src="https://www.zhihu.com/equation?tex=q%5En%5Crightarrow+0" alt="[公式]"> ，故级数： <img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bn+%5Cto+%5Cinfty%7DS_n=%5Cfrac%7Ba_1%7D%7B1-q%7D" alt="[公式]"> ，则称该级数发散；</p><p>若 <img src="https://www.zhihu.com/equation?tex=q%3E1" alt="[公式]"> 或 <img src="https://www.zhihu.com/equation?tex=q%3C-1" alt="[公式]"> ，则 <img src="https://www.zhihu.com/equation?tex=q%5En%5Crightarrow+%5Cpm%5Cinfty" alt="[公式]"> ，则级数： <img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bn+%5Cto+%5Cinfty%7DS_n=%5Cpm+%5Cinfty" alt="[公式]"> ，即为一种狭义的不存在，称该级数发散。</p><p>从等比数列的敛散性判别看得出，从定义出发直接对级数的求和表达式进行求极限的运算显然是一种较为直接的方式。</p><p>但是，并非每种数列，都可以像基本数列（如等差，等比）那样通过写出清晰的求和公式来进行讨论，我们还需要更多的方法来帮助我们判别和求解。</p><p>有数列通项 <img src="https://www.zhihu.com/equation?tex=u_n%5Cgeq+0" alt="[公式]"> ，存在三种类型的级数，即：</p><p>正项级数： <img src="https://www.zhihu.com/equation?tex=S_n=%5Csum_%7Bn=1%7D%5E%7B%5Cinfty%7Du_n=u_1+u_2+...u_n" alt="[公式]"> ，起所有项数均为正；</p><p>交错级数： <img src="https://www.zhihu.com/equation?tex=S_n=%5Csum_%7Bn=1%7D%5E%7B%5Cinfty%7D(-1)%5E%7Bn-1%7Du_n=u_1-u_2+u_3-u_4+...u_n" alt="[公式]"> ，数列项数为正负相间；</p><p>任意项级数：数列各项正负不一。</p><p>对这三类级数，应使用不同的方法判别其敛散性。</p><p>对于正项级数：</p><ol><li>根据 <img src="https://www.zhihu.com/equation?tex=S_n%5Cgeq+S_%7Bn-1%7D" alt="[公式]"> ，即级数恒不增，故可以使用有界性；</li><li>比较判别法：将 <img src="https://www.zhihu.com/equation?tex=u_n" alt="[公式]"> 与另一个已知敛散性的级数项 <img src="https://www.zhihu.com/equation?tex=v_n" alt="[公式]"> 进行比较;</li><li>比值判别法：通过比较 <img src="https://www.zhihu.com/equation?tex=%5Crho+=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cfrac%7Bu_%7Bn+1%7D%7D%7Bu_n%7D" alt="[公式]"> 与1的关系；</li><li>根植判别法：通过比较 <img src="https://www.zhihu.com/equation?tex=%5Crho+=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Csqrt%5Bn%5D%7Bu_n%7D+" alt="[公式]"> 与1的关系。</li></ol><p>对于交错级数，则需使用莱布尼茨判别法，即满足去除正负号的数列 <img src="https://www.zhihu.com/equation?tex=%5C%7Bu_n%5C%7D" alt="[公式]"> 单调不增且 <img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bn+%5Cto+%5Cinfty%7Du_n=0" alt="[公式]"> ，则该交错级数收敛。</p><p>而对于任意项级数，以目前我们所学的内容，暂时还不能给出通用的判别方式。</p><p>不过如果通过绝对值运算 <img src="https://www.zhihu.com/equation?tex=S_n=%5Csum_%7Bn=1%7D%5E%7B%5Cinfty%7D%5Cvert+u_n%5Cvert+" alt="[公式]"> 将任意项级数转换为正项级数，就可以使用正项级数的判别法对其进行研究，这也由此引申除了绝对收敛的概念，即：</p><ul><li>若原级数的绝对值级数收敛，则称该级数绝对收敛；</li><li>若原级数收敛，但该级数的绝对值级数收敛，则称该级数条件收敛。</li></ul><hr><h2 id="以一个新的角度来看待函数"><a href="#以一个新的角度来看待函数" class="headerlink" title="以一个新的角度来看待函数"></a>以一个新的角度来看待函数</h2><p>想象有一根笔直的铁丝，然后我们用手对它进行变形，使它弯曲成一定的角度：</p><p><img src="https://pic2.zhimg.com/v2-7fe91eb75378b692d6f56acbc7fce36d_r.jpg" alt="img">对铁丝进行弯曲</p><p>接着，想象在直角坐标系中的横坐标轴，即为那根比直的铁丝；函数 <img src="https://www.zhihu.com/equation?tex=f(x)=e%5Ex" alt="[公式]"> 的图像则为弯曲后的铁丝：</p><p><img src="https://pic4.zhimg.com/v2-b8548ada14de1056caa386b5295838a3_r.jpg" alt="img">函数的图像变换</p><p>以这个例子为启示，我们是否，可以将函数看作是一种变换图形的模具。</p><p>在机械加工产业的制造车间里，为铸造模具送入一个原型坯料，经过加工后，将为我们返回一个模具形状的产品；若我们将函数 <img src="https://www.zhihu.com/equation?tex=f(x)" alt="[公式]"> 也看作是一种加工图形的模具，为它送入初始图形 <img src="https://www.zhihu.com/equation?tex=x" alt="[公式]"> 轴，经过模具的加工返回一个新的图形 <img src="https://www.zhihu.com/equation?tex=e%5Ex" alt="[公式]"></p><p>——即<strong>将函数，看作是一种变换图形的工具</strong>。</p><p>在有了这个概念以后，令人兴奋的问题来了：</p><p>如果现在，有一个异常复杂的图案，我们能否使用手里那根初始的铁丝，通过拗的方式，将它坳成复杂的图形？</p><p>换句话说，我们能否使用一些简单的图形，通过函数这个变换工具，将它变形为复杂的图形。</p><p>而此前，微积分的核心知识告诉我们：这，不正是用线性模拟非线性的过程吗？</p><hr><p>假设有一个 <img src="https://www.zhihu.com/equation?tex=n" alt="[公式]"> 阶可导的复杂图形 <img src="https://www.zhihu.com/equation?tex=y" alt="[公式]"></p><p><strong>第一步，从一根直铁丝开始：</strong></p><p>现在，我们手里有一根尚未经过任何加工的铁丝，要想将它逐渐变为一个想要的复杂图形。</p><p>首先，肯定是要将它摆放于图形上的某一点 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处，而它的倾斜角度——微分的只是告诉了我们，导数即函数在一点处切线的斜率——故我们的第一步就是将这根铁丝摆成为 复杂图形在 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处的切线：</p><p>有函数在某一点处的切线方程 <img src="https://www.zhihu.com/equation?tex=y-y_0=y%5Cprime(x-x_0)" alt="[公式]"></p><p>即： <img src="https://www.zhihu.com/equation?tex=y=f(x_0)+f%5Cprime(x_0)(x-x_0)" alt="[公式]"></p><p><img src="https://pic1.zhimg.com/v2-d6dc7a1c514f24ee629577fe64dce3dc_r.jpg" alt="img">从一根铁丝开始</p><p>但，显而易见的，若这根铁丝只能保持笔直，那么这样的摆放只能使得它在 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处这一点是与我们的目标图形相一致的，一旦偏离 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处，哪怕一点点，它们的形态都将不再吻合。</p><p><strong>因此，第二步：将这根铁丝坳弯一点点以使得它也能够贴合</strong> <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> <strong>处附近的图形</strong></p><p>根据连续函数的定义，若有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bx+%5Cto+x_0%7Df(x)=f(x_0)=A" alt="[公式]"></p><p>如果把极限符号去掉，即有：</p><p><img src="https://www.zhihu.com/equation?tex=f(x)=A+%5Calpha+(x)" alt="[公式]"></p><p>它的意思是在 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 附近（也即它的去心邻域）的一点 <img src="https://www.zhihu.com/equation?tex=x" alt="[公式]"> ，它的函数值与 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处的函数值存在一个微小的偏差 <img src="https://www.zhihu.com/equation?tex=%5Calpha(x)" alt="[公式]"></p><p>于是，我们来看这样一个极限，即根据 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处的导数定义有：</p><p><img src="https://www.zhihu.com/equation?tex=f%5Cprime(x_0)=%5Clim_%7Bx+%5Cto+x_0%7D%5Cfrac%7Bf(x)-f(x_0)%7D%7Bx-x_0%7D" alt="[公式]"></p><p>去掉极限符号，即有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cfrac%7Bf(x)-f(x_0)%7D%7Bx-x_0%7D=f%5Cprime(x_0)+%5Calpha(x)" alt="[公式]"></p><p>解出 <img src="https://www.zhihu.com/equation?tex=f(x)" alt="[公式]"> 的表达式为：</p><p><img src="https://www.zhihu.com/equation?tex=f(x)=f(x_0)+f%5Cprime(x_0)(x-x_0)+%5Calpha(x)(x-x_0)" alt="[公式]"></p><p>可以看到的是，表达式中前面的这两项构成的恰是第一步中已经摆好的切线 <img src="https://www.zhihu.com/equation?tex=y" alt="[公式]"> 。</p><p>因此，本质上，<strong>我们通过“拗铁丝”来使直线更贴合函数图形的过程，就是从 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处出发，通过求解偏差量 <img src="https://www.zhihu.com/equation?tex=%5Calpha(x)" alt="[公式]"> 来向 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 的邻域拓展，从而能够在更广范围内逼近原函数的过程。</strong></p><p>那么，问题来了，该如何求解 <img src="https://www.zhihu.com/equation?tex=%5Calpha(x)" alt="[公式]"> 这一偏差部分呢。</p><p><strong>对偏差的部分，再度使用线性拟合的思想！</strong></p><p>记第一次贴合后的局部偏差为 <img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x)" alt="[公式]"> ，则类比于对函数在 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处的第一次线性拟合过程：</p><p><img src="https://www.zhihu.com/equation?tex=f(x)=f(x_0)+f%5Cprime(x_0)(x-x_0)+%5Calpha_1(x)(x-x_0)" alt="[公式]"></p><p>将 <img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x)" alt="[公式]"> 视为新的等待逼近的函数，则有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x)=%5Calpha_1(x_0)+%5Calpha_1%5Cprime(x_0)(x-x_0)+%5Calpha_2(x)(x-x_0)" alt="[公式]"></p><p>其中， <img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x_0)" alt="[公式]"> 部分，代表拟合图形在 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 处的误差——而这是目前为止我们唯一精确贴合的点，故不存在误差——则有 <img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x_0)=0" alt="[公式]"></p><p>因此：</p><p><img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x)=%5Calpha_1%5Cprime(x_0)(x-x_0)+%5Calpha_2(x)(x-x_0)" alt="[公式]"></p><p>而由前文中的表达式 <img src="https://www.zhihu.com/equation?tex=%5Cfrac%7Bf(x)-f(x_0)%7D%7Bx-x_0%7D=f%5Cprime(x_0)+%5Calpha_1(x)" alt="[公式]"> 可知：</p><p><img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x)=%5Cfrac%7Bf(x)-f(x_0)%7D%7Bx-x_0%7D-f%5Cprime(x_0)" alt="[公式]"></p><p>根据导数的定义：</p><p><img src="https://www.zhihu.com/equation?tex=%5Calpha_1%5Cprime+(x)=%5Clim_%7Bx+%5Cto+x_0%7D%5Cfrac%7B%5Calpha_1(x)-%5Calpha_1(x_0)%7D%7Bx-x_0%7D=%5Clim_%7Bx+%5Cto+x_0%7D%5Cfrac%7B%5Calpha_1(x)%7D%7Bx-x_0%7D" alt="[公式]"></p><p>将 <img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x)" alt="[公式]"> 代入：</p><p><img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bx+%5Cto+x_0%7D%5Cfrac%7B%5Calpha_1(x)%7D%7Bx-x_0%7D=%5Clim_%7Bx+%5Cto+x_0%7D%5Cfrac%7B%5Cfrac%7Bf(x)-f(x_0)-f%5Cprime+(x_0)(x-x_0)%7D%7Bx-x_0%7D%7D%7Bx-x_0%7D=%5Clim_%7Bx+%5Cto+x_0%7D%5Cfrac%7Bf(x)-f(x_0)-f%5Cprime+(x_0)(x-x_0)%7D%7B(x-x_0)%5E2%7D" alt="[公式]"></p><p>这是一个 <img src="https://www.zhihu.com/equation?tex=%5Cfrac%7B0%7D%7B0%7D" alt="[公式]"> 型的未定式极限，可以使用洛必达进行求解：</p><p><img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bx+%5Cto+x_0%7D%5Cfrac%7Bf(x)-f(x_0)-f%5Cprime+(x_0)(x-x_0)%7D%7B(x-x_0)%5E2%7D=%5Clim_%7Bx+%5Cto+x_0%7D%5Cfrac%7Bf%5Cprime(x)-0-f%5Cprime(x_0)%5Ccdot+1%7D%7B2(x-x_0)%5Ccdot+1%7D=%5Cfrac%7Bf%5Cprime%5Cprime(x)-0%7D%7B2-0%7D=%5Cfrac%7Bf%5Cprime%5Cprime(x)%7D%7B2%7D" alt="[公式]"></p><p>因此：</p><p><img src="https://www.zhihu.com/equation?tex=%5Calpha_1(x)=%5Calpha_1%5Cprime(x_0)(x-x_0)+%5Calpha_2(x)(x-x_0)=%5Cfrac%7Bf%5Cprime%5Cprime(x)%7D%7B2%7D(x-x_0)+%5Calpha_2(x)(x-x_0)" alt="[公式]"></p><p>然后，将这个结果带过原函数的展开式中得出：</p><p><img src="https://www.zhihu.com/equation?tex=f(x)=f(x_0)+f%5Cprime(x_0)(x-x_0)+%5Cfrac%7Bf%5Cprime%5Cprime(x)%7D%7B2%7D(x-x_0)%5E2+%5Calpha_2(x)(x-x_0)%5E2" alt="[公式]"></p><p>这样，我们就实现了将铁丝掰弯一点点的过程：</p><p><img src="https://pic4.zhimg.com/v2-221da1249e652432145f34f02fe2f9fb_r.jpg" alt="img">求解偏差部分的过程，就是对直线进行弯折以使得它再更大范围内贴合图形的过程</p><p><strong>集中一点，登峰造极</strong></p><p>于是，进一步的，通过对 <img src="https://www.zhihu.com/equation?tex=%5Calpha_2(x),%5Calpha_3(x)..." alt="[公式]"> 不断求解，我们也在不断的调整“铁丝”，不断的在越来越广 的 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 邻域上精确毕竟函数。</p><p><img src="https://pic4.zhimg.com/v2-900bcb5e775bba2f0c306465228781ef_r.jpg" alt="img">从一点处出发，越来越精确刻画其邻域内的图形</p><p>最终，我们就得到了这样一个函数展开式：</p><p><img src="https://www.zhihu.com/equation?tex=f(x)=%5Cfrac%7Bf(x_0)%7D%7B0!%7D+%5Cfrac%7Bf%5Cprime(x_0)%7D%7B1!%7D(x-x_0)+%5Cfrac%7Bf%5Cprime%5Cprime(x)%7D%7B2!%7D(x-x_0)%5E2+...+%5Cfrac%7Bf%5E%7B(n)%7D(x)%7D%7Bn!%7D(x-x_0)%5En+%5Calpha_%7Bn+1%7D(x)(x-x_0)%5E%7Bn+1%7D" alt="[公式]"></p><p>而在前文我们已经知道，数列的无穷项求和，就是级数。</p><p>当把数列中的通项，由确定的数值，推广至函数，即 <img src="https://www.zhihu.com/equation?tex=u_n=f_n(x)" alt="[公式]"> 。则无穷级数的概念，就从数列的常数项级数拓展到了函数项级数。</p><p>再进一步的，如果在函数项级数中的各项函数，都是属于同一系列(series)的函数，譬如：前文这个展开式所表示的函数项级数，其每一项就都是由 <img src="https://www.zhihu.com/equation?tex=x" alt="[公式]"> 的多项式与一个常系数相乘构成的幂函数组成。</p><p>这种由幂函数构成的函数项级数，就是<strong>幂级数</strong>，而上文这个幂级数，就是<strong>泰勒级数</strong>。</p><p>而通过前面这一系列的推导，你应该可以理解，幂级数之所以如此特殊，之所以在分析学中占据如此重要的地位，其本质是因为：</p><p><strong>常义的微分与积分是以区间为整体对函数进行全局的线性拟合；而幂级数是从一点处出发对函数进行局部的线性拟合。</strong></p><p>一个是高屋建瓴，把握整体；一个是集中一点，登峰造极！</p><hr><h2 id="幂级数的收敛域"><a href="#幂级数的收敛域" class="headerlink" title="幂级数的收敛域"></a>幂级数的收敛域</h2><p>有函数项级数：</p><p><img src="https://www.zhihu.com/equation?tex=%5Csum_%7Bn%7D%5E%7B%5Cinfty%7Du_n(x)=u_1(x)+u_2(x)+...u_n(x)" alt="[公式]"></p><p>当 <img src="https://www.zhihu.com/equation?tex=u_n(x)" alt="[公式]"> 为定义域 <img src="https://www.zhihu.com/equation?tex=x%5Cin+I%5C!R" alt="[公式]"> 的幂函数时，则有幂级数：</p><p><img src="https://www.zhihu.com/equation?tex=%5Csum_%7Bn%7D%5E%7B%5Cinfty%7Da_n(x-x_0)%5En=a_0+a_1(x-x_0)+a_2(x-x_0)%5E2+...+a_n(x-x_0)%5En" alt="[公式]"></p><p>幂级数本身是一个任意项级数，由前文得知，可以将它转变为绝对值级数，然后通过判断它是否绝对收敛来判断原级数的敛散性。</p><p>故，可以通过比值判别法，比较：</p><p><img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cvert%5Cfrac%7Bu_%7Bn+1%7D(x)%7D%7Bu_n(x)%7D%5Cvert=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cvert+%5Cfrac%7Ba_%7Bn+1%7D(x-x_0)%5E%7Bn+1%7D%7D%7Ba_n(x-x_0)%5En%7D+%5Cvert=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cvert+%5Cfrac%7Ba_%7Bn+1%7D%7D%7Ba_n%7D(x-x_0)++%5Cvert" alt="[公式]"></p><p>与1的关系来判别绝对值级数的敛散性。</p><p>而其中， <img src="https://www.zhihu.com/equation?tex=x" alt="[公式]"> 为 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 去心邻域内的一点，即：</p><p><img src="https://www.zhihu.com/equation?tex=0%3C%5Cvert+x-x_0%5Cvert%3C%5Csigma,%5Csigma%3E0" alt="[公式]"> ， 我们知道 <img src="https://www.zhihu.com/equation?tex=%5Csigma" alt="[公式]"> 即该去心邻域的半径；</p><p>同时可记 <img src="https://www.zhihu.com/equation?tex=%5Crho=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cvert+%5Cfrac%7Ba_%7Bn+1%7D%7D%7Ba_n%7D+%5Cvert" alt="[公式]"> ，因此我们只需讨论 <img src="https://www.zhihu.com/equation?tex=%5Crho%5Ccdot+%5Csigma" alt="[公式]"> 与1之间的关系：</p><ul><li>若满足 <img src="https://www.zhihu.com/equation?tex=%5Crho+%5Ccdot+%5Csigma+%3C+1" alt="[公式]"> ，则绝对值级数收敛，原级数必收敛；</li><li>若满足 <img src="https://www.zhihu.com/equation?tex=%5Crho%5Ccdot+%5Csigma%3E1" alt="[公式]"> ，则绝对值级数发散，原级数必发散；</li><li>若 <img src="https://www.zhihu.com/equation?tex=%5Crho+%5Ccdot+%5Csigma=1" alt="[公式]"> ，则无法通过比值判别法判断敛散性。</li></ul><p>故可据此来讨论 <img src="https://www.zhihu.com/equation?tex=%5Crho" alt="[公式]"> 的不同取值：</p><ul><li>若 <img src="https://www.zhihu.com/equation?tex=%5Crho=0" alt="[公式]"> ，则 <img src="https://www.zhihu.com/equation?tex=%5Crho%5Ccdot+%5Csigma+%5Cequiv0+%3C1" alt="[公式]"> ，无论去心邻域的半径 <img src="https://www.zhihu.com/equation?tex=%5Csigma" alt="[公式]"> 取多大，级数都必然收敛；</li><li>若 <img src="https://www.zhihu.com/equation?tex=0%3C%5Crho%3C+%5Cinfty" alt="[公式]"> ，则为了满足 <img src="https://www.zhihu.com/equation?tex=%5Crho+%5Ccdot+%5Csigma%3C1" alt="[公式]"> ，需要使去心邻域半径 <img src="https://www.zhihu.com/equation?tex=%5Csigma%3C%5Cfrac%7B1%7D%7B%5Crho%7D" alt="[公式]"> ；</li><li>若 <img src="https://www.zhihu.com/equation?tex=%5Crho=+%5Cinfty" alt="[公式]"> ，则无论去心邻域的半径取多小，都不可能满足 <img src="https://www.zhihu.com/equation?tex=%5Crho+%5Ccdot+%5Csigma%3C1" alt="[公式]"></li></ul><p>此外，可以看到，在 <img src="https://www.zhihu.com/equation?tex=0%3C%5Crho%3C+%5Cinfty" alt="[公式]"> 时，若 <img src="https://www.zhihu.com/equation?tex=%5Csigma=%5Cfrac%7B1%7D%7B%5Crho%7D" alt="[公式]"> ，即恰好处于去心邻域的边界时，我们无法通过比值判别法直接判断这两点的敛散性。</p><p>在这其中，我们将满足幂级数收敛的定义域范围 <img src="https://www.zhihu.com/equation?tex=(x_0-%5Csigma,+x_0+%5Csigma)" alt="[公式]"> 成为幂级数的收敛域，将收敛域的边界点 <img src="https://www.zhihu.com/equation?tex=x_0-%5Csigma" alt="[公式]"> 与 <img src="https://www.zhihu.com/equation?tex=x_0+%5Csigma" alt="[公式]"> 称为收敛点，定义域的半径 <img src="https://www.zhihu.com/equation?tex=%5Csigma" alt="[公式]"> 称为幂级数的收敛半径。</p><p>因此，对于之前敛散性判别的结论整理后，有：</p><p>若 <img src="https://www.zhihu.com/equation?tex=%5Crho=0" alt="[公式]"> ，则该幂级数在整个定义域上恒收敛，收敛半径为 <img src="https://www.zhihu.com/equation?tex=+%5Cinfty" alt="[公式]"> ;</p><p>若 <img src="https://www.zhihu.com/equation?tex=%5Crho=+%5Cinfty" alt="[公式]"> ，则该幂级数在 <img src="https://www.zhihu.com/equation?tex=x_0" alt="[公式]"> 以外的所有区域全部发散，收敛半径为 <img src="https://www.zhihu.com/equation?tex=0" alt="[公式]"> ；</p><p>若 <img src="https://www.zhihu.com/equation?tex=0%3C%5Crho%3C+%5Cinfty" alt="[公式]"> ，则该幂级数的收敛半径为 <img src="https://www.zhihu.com/equation?tex=%5Cfrac%7B1%7D%7B%5Crho%7D" alt="[公式]"> ，在收敛半径以内 <img src="https://www.zhihu.com/equation?tex=(x_0-%5Cfrac%7B1%7D%7B%5Crho%7D,x_0+%5Cfrac%7B1%7D%7B%5Crho%7D)" alt="[公式]"> 全部收敛，在收敛半径以外 <img src="https://www.zhihu.com/equation?tex=(-%5Cinfty,+x_0-%5Cfrac%7B1%7D%7B%5Crho%7D),(x_0+%5Cfrac%7B1%7D%7B%5Crho%7D,+%5Cinfty)" alt="[公式]"> 全部发散，在收敛半径处 <img src="https://www.zhihu.com/equation?tex=x_0-%5Cfrac%7B1%7D%7B%5Crho%7D,x_0+%5Cfrac%7B1%7D%7B%5Crho%7D" alt="[公式]"> 需单独判断。而这个结论，也就是幂级数的<strong>阿贝尔收敛定理</strong>。</p><p>更本质的来说，<strong>求解幂级数收敛域的过程，实际上，就是在求我们通过“拗铁丝”方式得到的拟合图像与目标函数实现贴合的范围</strong>。</p><p><img src="https://pic4.zhimg.com/v2-98099080849ac47c3c460fb88847d4d7_r.jpg" alt="img">求解收敛域，就是求取局部贴合的范围</p><hr><p>对于泰勒级数：</p><p><img src="https://www.zhihu.com/equation?tex=f(x)=%5Cfrac%7Bf(x_0)%7D%7B0!%7D+%5Cfrac%7Bf%5Cprime(x_0)%7D%7B1!%7D(x-x_0)+%5Cfrac%7Bf%5Cprime%5Cprime(x)%7D%7B2!%7D(x-x_0)%5E2+...+%5Cfrac%7Bf%5E%7B(n)%7D(x)%7D%7Bn!%7D(x-x_0)%5En+..." alt="[公式]"></p><p>对于特别的当 <img src="https://www.zhihu.com/equation?tex=x_0=0" alt="[公式]"> 时，也就是对函数在零点处展开，其形式变为：</p><p><img src="https://www.zhihu.com/equation?tex=f(0)+f%5Cprime(0)x+%5Cfrac%7Bf%5Cprime%5Cprime(0)%7D%7B2!%7Dx%5E2+...+%5Cfrac%7Bf%5E%7B(n)%7D(0)%7D%7Bn!%7Dx%5En+..." alt="[公式]"></p><p>将这个级数称为<strong>麦克劳林级数</strong>。</p><p>我们在求极限时，用到的等价无穷小，绝大多数都是由麦克劳林公式推导得来，譬如经典的：</p><p><img src="https://www.zhihu.com/equation?tex=%5Csin+x+%5Csim+x,x+%5Cto+0" alt="[公式]"></p><p>即有 <img src="https://www.zhihu.com/equation?tex=%5Csin+x" alt="[公式]"> 的麦克劳林展开式：</p><p><img src="https://www.zhihu.com/equation?tex=%5Csin+x=%5Csin+0+%5Ccos+0%5Ccdot+x+%5Cfrac%7B-%5Csin+0%7D%7B2!%7D+x%5E2+%5Cfrac%7B-%5Ccos+0%7D%7B3!%7Dx%5E3+...=x-%5Cfrac%7Bx%5E3%7D%7B3!%7D+%5Cfrac%7Bx%5E5%7D%7B5!%7D+..." alt="[公式]"></p><p>等价无穷小就是通过忽略麦克劳林的高阶无穷小部分获得的。</p><p>级数的另一个重要作用，是为我们提供高精度的数值计算手段，譬如：</p><p>如何计算 <img src="https://www.zhihu.com/equation?tex=%5Cpi" alt="[公式]"></p><p>在现实世界的各种实际应用中，如计算机、工业制造、导弹的弹道等等领域，往往需要使用诸如 <img src="https://www.zhihu.com/equation?tex=e,%5Cpi" alt="[公式]"> 等等之类的具体数值，且有极高的精度要求。在这些领域，幂级数就能为我们提供有效的计算手段。</p><p>有 <img src="https://www.zhihu.com/equation?tex=%5Carctan+x" alt="[公式]"> 的麦克劳林级数：</p><p><img src="https://www.zhihu.com/equation?tex=%5Carctan+x=x-%5Cfrac%7Bx%5E3%7D%7B3%7D+%5Cfrac%7Bx%5E5%7D%7B5%7D+...+(-1)%5E%7Bn+1%7D%5Cfrac%7Bx%5E%7B2n-1%7D%7D%7B2n-1%7D+..." alt="[公式]"></p><p>通过求：</p><p><img src="https://www.zhihu.com/equation?tex=%5Crho=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cvert+%5Cfrac%7Ba_%7Bn+1%7D%7D%7Ba_n%7D+%5Cvert=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cvert+%5Cfrac%7B(-1)%5E%7B2n-3%7D(2n-3)%7D%7B(-1)%5E%7B2n-1%7D(2n-1)%7D+%5Cvert=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cvert+%5Cfrac%7B2n-3%7D%7B2n-1%7D+%5Cvert=1" alt="[公式]"></p><p>可知，该级数的收敛半径为 <img src="https://www.zhihu.com/equation?tex=r=%5Cfrac%7B1%7D%7B%5Crho%7D=1" alt="[公式]"> ，故在 <img src="https://www.zhihu.com/equation?tex=-1%3C+x%3C1" alt="[公式]"> 上绝对收敛，而在半径处，即 <img src="https://www.zhihu.com/equation?tex=x=-1,x=1" alt="[公式]"> 处，则需要单独讨论：</p><p>由于对绝对值级数的比值判别法失效，则可以改用交错级数的莱布尼茨判别法，当 <img src="https://www.zhihu.com/equation?tex=%5Cvert+x+%5Cvert=1" alt="[公式]"> 时，其去除正负号后的数列 <img src="https://www.zhihu.com/equation?tex=%5C%7Bu_n%5C%7D" alt="[公式]"> ，显然有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cfrac%7B1%7D%7B2n-1%7D%3C%5Cfrac%7B1%7D%7B2n-3%7D%5Cimplies+u_%7Bn-1%7D%3Cu_n" alt="[公式]"></p><p>且：</p><p><img src="https://www.zhihu.com/equation?tex=%5Clim_%7Bn+%5Cto+%5Cinfty%7Du_n=%5Clim_%7Bn+%5Cto+%5Cinfty%7D%5Cfrac%7B1%7D%7B2n-1%7D=0" alt="[公式]"></p><p>故该级数在半径处也收敛，即 <img src="https://www.zhihu.com/equation?tex=%5Carctan+x" alt="[公式]"> 的麦格劳林级数收敛域为 <img src="https://www.zhihu.com/equation?tex=x%5Cin%5B-1,1%5D" alt="[公式]"></p><p>而由三角函数的取值可知， <img src="https://www.zhihu.com/equation?tex=%5Carctan+1=%5Cfrac%7B%5Cpi%7D%7B4%7D" alt="[公式]"></p><p>利用麦克劳林展开式，有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Carctan+1=%5Cfrac%7B%5Cpi%7D%7B4%7D=1-%5Cfrac%7B1%7D%7B3%7D+%5Cfrac%7B1%7D%7B5%7D+..." alt="[公式]"> ，得出 <img src="https://www.zhihu.com/equation?tex=%5Cpi=4(1-%5Cfrac%7B1%7D%7B3%7D+%5Cfrac%7B1%7D%7B5%7D+...)" alt="[公式]"></p><p>若展开至第二项，有： <img src="https://www.zhihu.com/equation?tex=%5Cpi=4(1-%5Cfrac%7B1%7D%7B3%7D)=2.%5Cdot%7B6%7D" alt="[公式]"></p><p>展开至第三项：有： <img src="https://www.zhihu.com/equation?tex=%5Cpi=4(1-%5Cfrac%7B1%7D%7B3%7D+%5Cfrac%7B1%7D%7B5%7D)=3.4%5Cdot%7B6%7D" alt="[公式]"></p><p>至第四项，有： <img src="https://www.zhihu.com/equation?tex=%5Cpi=4(1-%5Cfrac%7B1%7D%7B3%7D+%5Cfrac%7B1%7D%7B5%7D-%5Cfrac%7B1%7D%7B7%7D)=2.89523%5Cdot%7B8%7D0952%5Cdot%7B3%7D" alt="[公式]"></p><p>…</p><p>这就是使用麦克劳林级数推导出的一个圆周率计算公式。</p><blockquote><p>值得一提的是，利用 <img src="https://www.zhihu.com/equation?tex=%5Carctan+x" alt="[公式]"> 在的麦克劳林级数计算 <img src="https://www.zhihu.com/equation?tex=%5Cpi" alt="[公式]"> 的过程，其收敛速度相当缓慢，在展开到第100项左右， <img src="https://www.zhihu.com/equation?tex=%5Cpi" alt="[公式]"> 的值也只接近于3.1315929。你能否想出收敛速度更快的级数来帮助我们更快的算出较为精确的圆周率数值~</p></blockquote><hr><p>结束级数的学习之后，我们对一元微积分的热身活动就基本完毕。</p><p>在这一段的历程中，我们建立了：</p><p>原函数 <img src="https://www.zhihu.com/equation?tex=F(x)" alt="[公式]"> <img src="https://www.zhihu.com/equation?tex=%5Ciff" alt="[公式]"> 函数 <img src="https://www.zhihu.com/equation?tex=f(x)" alt="[公式]"> <img src="https://www.zhihu.com/equation?tex=%5Ciff" alt="[公式]"> 导函数 <img src="https://www.zhihu.com/equation?tex=f%5Cprime(x)" alt="[公式]"> <img src="https://www.zhihu.com/equation?tex=%5Ciff" alt="[公式]"> 高阶导函数 <img src="https://www.zhihu.com/equation?tex=f%5E%7B(2+)%7D(x)" alt="[公式]"></p><p>这数者之间的联系。</p><p>从 <img src="https://www.zhihu.com/equation?tex=f(x)" alt="[公式]"> 出发：</p><p>以求导、微分、中值定理连接导函数 <img src="https://www.zhihu.com/equation?tex=f%5Cprime(x)" alt="[公式]"></p><p>以积分、变限积分联系原函数 <img src="https://www.zhihu.com/equation?tex=F(x)" alt="[公式]"></p><p>以幂级数展开联系高阶导函数 <img src="https://www.zhihu.com/equation?tex=f%5Cprime%5Cprime(x),f%5Cprime%5Cprime(x)..." alt="[公式]"></p><p>从下一篇文章开始，在将微积分从一元函数向二元、三元推广之前，我准备先转入线性代数的学习。</p><p>这其中的原因，我也将会在之后学习线性代数的过程中，以及在开始学习多元函数微积分前，予以说明。</p>]]></content>
      
      
      <categories>
          
          <category> 高等数学 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>坂本龙一先生对我的影响</title>
      <link href="2021/04/16/%E2%80%9C%E5%9D%82%E6%9C%AC%E9%BE%99%E4%B8%80%E5%85%88%E7%94%9F%E5%AF%B9%E6%88%91%E7%9A%84%E5%BD%B1%E5%93%8D%E2%80%9D/"/>
      <url>2021/04/16/%E2%80%9C%E5%9D%82%E6%9C%AC%E9%BE%99%E4%B8%80%E5%85%88%E7%94%9F%E5%AF%B9%E6%88%91%E7%9A%84%E5%BD%B1%E5%93%8D%E2%80%9D/</url>
      
        <content type="html"><![CDATA[<p>硬要说影响几乎没有，自然流露的就是最好的，他的通透就是我繁琐俗常生活的一面自我之象吧。</p><p>不忘记看每天的月亮，直至生命燃尽：坂本龙一68岁了</p><iframe frameborder="0" allowfullscreen src="https://www.zhihu.com/video/1200375282907267072?autoplay=false&amp;useMSE="></iframe><p>《坂本龙一：终曲》正在中国上映，</p><p>导演史蒂芬从2012年到2017年，</p><p>5年跟拍制作，</p><p>完成这部关于坂本龙一的纪录片。</p><p>豆瓣上3万5千人看过，打出8.8的高分。</p><p><img src="https://pic1.zhimg.com/50/v2-2998f7738c6c2ad054171d8d233a67a8_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-2998f7738c6c2ad054171d8d233a67a8_r.jpg?source=1940ef5c" alt="img"></p><p>1989年 摄影：Albert Watson</p><p>坂本龙一，被大家昵称“教授”，</p><p>世界级音乐家、电影配乐大师，</p><p>是亚洲年轻人的共同偶像。</p><p><img src="https://pic4.zhimg.com/50/v2-73fc99cb5f0cb5e514466b958694c73c_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-73fc99cb5f0cb5e514466b958694c73c_r.jpg?source=1940ef5c" alt="img"></p><p>坂本年轻时组乐队YMO，在欧美和日本走红，</p><p>对后世的电子乐、hip-hop有开创性影响，</p><p>35岁因《末代皇帝》获得奥斯卡最佳原创配乐。</p><p>38岁定居纽约后，</p><p>常以环保、反战为题材进行创作。</p><p>粉丝对他的喜爱，早就不限音乐，</p><p>而是把他当做一种文化ICON、</p><p>一个精神领袖，去崇敬。</p><p><img src="https://pic2.zhimg.com/50/v2-2a4c1ea7a78d4bf6a6bbfa87e38e276f_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-2a4c1ea7a78d4bf6a6bbfa87e38e276f_r.jpg?source=1940ef5c" alt="img">一条专访斯蒂芬导演</p><p>再过一周，就是坂本龙一的68岁生日。</p><p>我们在《坂本龙一：终曲》上映之际，</p><p>专访了来到北京的史蒂芬导演，</p><p>“我希望这部电影，能让大家感受到</p><p>坂本龙一是如何听到这个世界的。”  <strong>编辑 倪蒹葭</strong></p><p><img src="https://pic4.zhimg.com/50/v2-116078311a84bf9a10d737634c4c304a_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-116078311a84bf9a10d737634c4c304a_r.jpg?source=1940ef5c" alt="img"></p><p><img src="https://pic4.zhimg.com/50/v2-b1311b063acbda54cfd48a388b61ff95_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-b1311b063acbda54cfd48a388b61ff95_r.jpg?source=1940ef5c" alt="img"></p><p>2017年9月，威尼斯电影节，纪录片《坂本龙一：终曲》世界首映，现场观众起立鼓掌，长时间不息。</p><p>前排的坂本龙一有些害羞，他略有尴尬地对身边的纪录片导演说：斯蒂芬，我们离开这里吧。</p><p>《坂本龙一：终曲》记录了这位音乐家，在日本福岛核泄露、及亲历咽喉癌之后，如何用艺术回应灾难，重新开始创作音乐。</p><p>2019年12月，电影终于在中国上映。乐迷、影迷等各路粉丝，纷纷前往膜拜。</p><p><video class="ztext-gif GifPlayer-gif2mp4" src="https://vdn1.vzuu.com/SD/dc7bf35c-23c4-11eb-b41f-86c835170013.mp4?disable_local_cache=1&amp;auth_key=1618591333-0-0-7e822bfcbe0f42ae907c128a310e315f&amp;f=mp4&amp;bu=pico&amp;expiration=1618591333&amp;v=hw" data-thumbnail="https://pic1.zhimg.com/50/v2-ef62e3c5be230f0e204aa7369698778f_hd.jpg?source=1940ef5c" poster="https://pic1.zhimg.com/50/v2-ef62e3c5be230f0e204aa7369698778f_hd.jpg?source=1940ef5c" data-size="normal" preload="metadata" loop playsinline></video></p><p><img src="https://pic1.zhimg.com/50/v2-ef62e3c5be230f0e204aa7369698778f_hd.jpg?source=1940ef5c" alt="img"></p><p>坂本龙一在格陵兰岛，为当地自然声着迷</p><p><img src="https://pic3.zhimg.com/50/v2-f5711a8d22e374061c44db6aa0b6f28b_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-f5711a8d22e374061c44db6aa0b6f28b_r.jpg?source=1940ef5c" alt="img">《坂本龙一：终曲》截图《终曲》</p><p>从2012年开拍，2017年完成。</p><p>起初，导演史蒂芬想要拍摄一部演奏会电影，然而在2014年，坂本龙一被诊断出了癌症，纪录片的方向也随之改为传记纪录片，我们也得以了解坂本龙一不为人知的人生经历。</p><p><img src="https://pic2.zhimg.com/50/v2-b04a3556bfc5c40b8e62baea43b79454_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-b04a3556bfc5c40b8e62baea43b79454_r.jpg?source=1940ef5c" alt="img">YMO成军时期</p><p> <strong>古典乐出身，却成为日本当代音乐的革新者</strong> </p><p>坂本龙一1952年出生在东京，3岁开始学钢琴，年少时觉得自己是德彪西转世。</p><p>但坂本龙一从未刻意要成为音乐人，因为不想被任何固定职业限制，他在填写志愿的时候写了“没有志愿”，直到细野晴臣推了他一把。</p><p>1978年，细野晴臣邀请坂本龙一和高桥幸宏，一起组个乐队，就是后来赫赫有名的YMO（Yellow Magic Orchestra）。坂本当时刚从东京艺术大学作曲系研究生毕业，高桥幸宏打趣他，在搞音乐的人中算学历高的了，问他以后会不会成为教授。“教授”的昵称由此而来。</p><p><img src="https://pic2.zhimg.com/50/v2-829e24b20a7d0468fd7cf3c2eb04d5be_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-829e24b20a7d0468fd7cf3c2eb04d5be_r.jpg?source=1940ef5c" alt="img">YMO乐队，左起：细野晴臣、坂本龙一、高桥幸宏</p><p><img src="https://pic2.zhimg.com/50/v2-be11d83e55482d27c6b8d686f125a678_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-be11d83e55482d27c6b8d686f125a678_r.jpg?source=1940ef5c" alt="img">YMO专辑封面</p><p>坂本龙一惊讶于细野和高桥没受过正统音乐教育，却掌握了音乐的核心。与受系统古典音乐训练、热爱实验性现代音乐的坂本不同，细野和高桥的音乐源头中有爵士乐和流行音乐的元素。</p><p>YMO的音乐在欧美走红之后，开始在日本被接纳，80年代初的东京街头，随处可以听见YMO乐队前卫、高科技感的电子音乐。对后世的电子乐、hip-hop有开创性影响。</p><p>坂本说，“加入YMO之前，我不过是半瓶醋，在乐队中经历了争执和纠葛后，才一点一点成长。”</p><p>1983年，YMO在巅峰时解散，成为传奇；坂本龙一单飞，也开始在电影配乐领域大放异彩。</p><p><img src="https://pic1.zhimg.com/50/v2-ebb0560f7c46cf04f14927a4658c06c4_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-ebb0560f7c46cf04f14927a4658c06c4_r.jpg?source=1940ef5c" alt="img">《战场上的快乐圣诞》</p><p> <strong>电影配乐大师</strong> </p><p>1982年，电影导演大岛渚邀请坂本龙一主演《战场上的快乐圣诞》，饰演一名日本军官。坂本是大岛渚的影迷，看过他几乎所有电影，但傲娇的年轻人附加了一个要求：那请把配乐也交给我来做吧。大岛渚说好。当时日本电影通常是在上映前一周匆忙配上音乐，但是坂本向大岛渚要求了3个月时间，大岛渚再次同意，而且没有任何指示，给他100%创作自由。结果，主题曲《圣诞快乐，劳伦斯》的影响力，甚至超过了电影本身。</p><p><img src="https://pic4.zhimg.com/50/v2-659e0062a9f50399a8c1a05dd6dc8e7f_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic3.zhimg.com/v2-659e0062a9f50399a8c1a05dd6dc8e7f_r.jpg?source=1940ef5c" alt="img">《战场上的快乐圣诞》</p><p>メリー・クリスマス ミスターローレンス坂本龙一 - 戦場のメリー・クリスマス</p><p> 关于这首神曲的创作，坂本龙一本人是这样阐述的：“因为是圣诞，所以想用铃声。而电影故事发生在南太平洋的小岛，不能用欧洲的铃声，所以想到用巴厘岛甘美兰的声音。”</p><p>由此，坂本龙一开始了和多位国际名导合作电影配乐的生涯。</p><p><img src="https://pic1.zhimg.com/50/v2-428def30e5390c45307bf84c62b54434_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-428def30e5390c45307bf84c62b54434_r.jpg?source=1940ef5c" alt="img">《末代皇帝》剧照</p><p><img src="https://pic1.zhimg.com/50/v2-79577b71aaf6d3e39d68301b944d7a66_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-79577b71aaf6d3e39d68301b944d7a66_r.jpg?source=1940ef5c" alt="img">坂本龙一和陈冲，拍摄《末代皇帝》时</p><p>1986年，贝托鲁奇的《末代皇帝》在北京紫禁城开拍，邀请坂本龙一饰演日本军官甘粕正彦。拍摄结束后，他被紧急任命为影片作曲。</p><p>2个星期后，坂本交出了44首曲子。</p><p>皇妃文绣在雨中离开了溥仪的家，扔下雨伞出走，他为文绣写了一首《Rain》。第一次给意大利的工作人员听的时候，所有人互相拥抱，喊着，“bellissimo（太美了）、bellissimo（太美了）。</p><p>Rain坂本龙一 - The Last Emperor (Original Motion Picture Soundtrack)</p><p><img src="https://pic2.zhimg.com/50/v2-9187faa199c3be71edf4cfc788ea2273_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-9187faa199c3be71edf4cfc788ea2273_r.jpg?source=1940ef5c" alt="img">《末代皇帝》还获得了金球奖最佳原创配乐</p><p>其实坂本没有学习过中国音乐，他接到任务马上买来20多张中国音乐精选集，花了一天时间全部听完，2周赶出44首，完工之后就累得住院。</p><p>他说做电影配乐，是因为这些电影创作者吸引着他，“我好像继承了父亲的性格，很容易被人或事吸引，而且入迷。”</p><p><img src="https://pic1.zhimg.com/50/v2-8fa80867fa3fae0f4687f1537b588e22_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-8fa80867fa3fae0f4687f1537b588e22_r.jpg?source=1940ef5c" alt="img"></p><p>坂本龙一在纽约的私人工作室2014年，在自己癌症治疗的关键时期，坂本不顾家人反对，接受了电影《荒野猎人》的配乐邀请，因为没有办法对亚利桑德罗导演说不。</p><p>2017年，台湾导演蔡明亮把新片《你的脸》寄给他请他看看，他便回信说想要做这部电影的配乐。一个月后，坂本龙一把音乐发给了蔡明亮，附了一封短讯：您想用多少，用在哪里，都可以。</p><p>音乐放进电影中，非常贴合，后来获得台北电影节最佳原创配乐。</p><p> <strong>“万物皆音乐”</strong> </p><p>纪录片《终曲》中，坂本龙一随时随地都在收集、记录声音：</p><p><img src="https://pic2.zhimg.com/50/v2-7c81e2e48d9e3cf45047f6fbd0a5d915_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-7c81e2e48d9e3cf45047f6fbd0a5d915_r.jpg?source=1940ef5c" alt="img"></p><p>穿着蓝T的坂本龙一，头上套着个蓝色塑料桶，站在雨中感受雨滴敲击的声音。</p><p><img src="https://pic3.zhimg.com/50/v2-d8407c10bdee52b59ed31afed2b8f6c7_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-d8407c10bdee52b59ed31afed2b8f6c7_r.jpg?source=1940ef5c" alt="img"></p><p>潜入森林，收集踩在枯叶上的脚步声。</p><p><img src="https://pic2.zhimg.com/50/v2-2df0ecdee82cfa912a07f20b05db095c_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-2df0ecdee82cfa912a07f20b05db095c_r.jpg?source=1940ef5c" alt="img"></p><p>去非洲记录原始部落的歌声，在肯尼亚的湖泊上采集自然声。</p><p>少年时代，受到约翰·凯奇（John Cage）等现代音乐家影响，坂本龙一认为万物皆是音乐。80年代的巴厘岛旅行，他看到当地人在鸽子脚上系上鸽哨，放飞的时候，鸽哨发出忽远忽近的声响，和悠悠的风声、森林的声音混在一起，他念念难忘。</p><p>所以担任2014年札幌艺术节总监时，他设计的开幕式并不奏乐，而是让一群系上鸽哨的鸽子飞翔。</p><p><img src="https://pic2.zhimg.com/50/v2-081935cb5b8718fd3b889e9fcebd6b14_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-081935cb5b8718fd3b889e9fcebd6b14_r.jpg?source=1940ef5c" alt="img"></p><p>坂本龙一录屋顶上的雨声坂本龙一感兴趣的不仅是音乐本身，还有整个环境的声音景观。</p><p>“每次下雨的时候，我都打开窗户，然后把录音器放出去。”他会在任何地方敲打看到的东西，了解它们的声音。在巴塞罗那，一辆巡逻车响着汽笛驶过，他赶紧掏出手机录音，为没有错过这个声音开心。</p><p><img src="https://pic4.zhimg.com/50/v2-6b7403723688ba05c113700e51da835c_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-6b7403723688ba05c113700e51da835c_r.jpg?source=1940ef5c" alt="img"></p><p>2011年日本海啸和福岛核泄漏后，坂本龙一发现了一架被海啸吞噬过的钢琴，钢琴完全走音了，他却被这个声音迷住了，“海浪一瞬间涌上来，让钢琴回复到自然状态，经过自然调音的钢琴声，我觉得特别美。”</p><p>他把这架钢琴的声音，放进了新专辑《异步》中。</p><p><img src="https://pic4.zhimg.com/50/v2-0fcb5566e480df56a64ebd3e88e90491_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic3.zhimg.com/v2-0fcb5566e480df56a64ebd3e88e90491_r.jpg?source=1940ef5c" alt="img">《坂本龙一：终曲》截图纪录片</p><p>《终曲》的拍摄过程，刚好也是坂本龙一新专辑《异步》的创作阶段。他十分喜欢这张专辑，甚至有把它藏起来、不给别人听的想法。</p><p>这张专辑里的音乐与以往十分不同：</p><p>几乎没有旋律，而是由踩在落叶上的脚步声、被海啸损坏的钢琴发出的声音、测量核污染仪器的哀嚎声、日本传统的三味线等等声音，奇妙地组合着。</p><p>这是福岛事故和经历癌症之后，更加感受生命脆弱的坂本龙一，最想要做的音乐。</p><p><img src="https://pic1.zhimg.com/50/v2-efbe91cc188b6c49b3198d034fe0ec85_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-efbe91cc188b6c49b3198d034fe0ec85_r.jpg?source=1940ef5c" alt="img">2017年NHK专访坂本龙一</p><p>2017年《异步》发行之时，他在NHK电视台被访问道，想以怎样的方式燃烧至尽，坂本想了一会回答，“确实有一个强烈的想法，就是不对自己说谎，想做真实的音乐，真实地活下去，还有不忘记看每天的月亮。”</p><p>虽然早在80年代就成为欧美和日本的音乐偶像，但坂本龙一从未停止对音乐边界的探索。在现代音乐、古典乐、流行乐、电子乐、民族乐等等之间来回跳跃，也在地球的各个地方，北极、非洲、南洋小岛汲取声音灵感，越来越不受到限制。</p><p><img src="https://pic1.zhimg.com/50/v2-c37c1820fc76f3259c0bbc2d465d4193_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-c37c1820fc76f3259c0bbc2d465d4193_r.jpg?source=1940ef5c" alt="img"></p><p><img src="https://pic2.zhimg.com/50/v2-2c93b8f87a25cf2e2efbc0a1081455e5_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-2c93b8f87a25cf2e2efbc0a1081455e5_r.jpg?source=1940ef5c" alt="img"></p><p>“总觉得无论我们说什么，上头的人都听不见。最终又回归沉默，日本人已经沉默四十多年了。”</p><p>纪录片《终曲》中，坂本龙一参加了反对重启核电站的大型集会，他说：“不管是核电站事故，还是灾后日本的政治状况、社会情况，全都每况愈下……如果不把自己的想法说出来，我会感到非常压抑。我做不到视而不见。”</p><p>一直以来，坂本龙一有自己鲜明的政治立场，是积极的社会活动推动者。</p><p><img src="https://pic4.zhimg.com/50/v2-15d8972cab1f4136e4d001f23bfa13e4_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-15d8972cab1f4136e4d001f23bfa13e4_r.jpg?source=1940ef5c" alt="img">大学时的坂本龙一</p><p>坂本龙一的父亲是出版社编辑，母亲是帽子设计师。70年代，左翼思潮在日本非常流行。出身有闲阶级的坂本龙一，从高中就是一枚左翼热血青年，积极参加左翼运动。</p><p>“仿效中国的精神，我们也要用音乐为工农服务！”“一起解放被资本主义操控的音乐”。反对学校统一的制服，统一的考试制度，在他们高中的罢课运动中，校服、校帽和考试，真的因此被取消了。</p><p>虽然坂本龙一最后还是参加大学入学考试，但他认为自己带着“瓦解大学制度”的想法进入了东京艺术大学。</p><p><img src="https://pic2.zhimg.com/50/v2-bde677543068ef21115c2ab7bafc9cc2_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-bde677543068ef21115c2ab7bafc9cc2_r.jpg?source=1940ef5c" alt="img">高中时的坂本龙一</p><p><img src="https://pic4.zhimg.com/50/v2-53da80c701221fd4bb00affeefd6c36e_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-53da80c701221fd4bb00affeefd6c36e_r.jpg?source=1940ef5c" alt="img">1969年，在新宿高中校舍前发表激情演说</p><p>在自传《音乐即自由》中，坂本龙一回忆当年积极参加运动的自己，“当时有个传言，在被封锁的新宿高中校园里，坂本带着安全帽在弹奏德彪西的乐曲。不过我已经不记得这些事了，如果我真的做过，毫无疑问就是想出风头。”</p><p>如果说少年时代的积极运动，带着“中二”气息，38岁搬到纽约居住之后，他越来越深刻感受到存在于世界上的断层。</p><p><img src="https://pic2.zhimg.com/50/v2-b47273c547a0e2802b7635cc56d1252d_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-b47273c547a0e2802b7635cc56d1252d_r.jpg?source=1940ef5c" alt="img">摄于南青山的个人录音室</p><p>1997年，写下《Discord》（意为不调和、争端）这首曲子是因为，他看到电视正在报道卢旺达内战难民的新闻，当天夜里，梦到自己想要写一首关于这起事件的管弦乐曲，于是立刻起身，冲到位于地下室的工作室内，赶紧动笔写下了。</p><p>“当时我有一种无法沉默下去的心情。对我来说，这应该是一个很大的转机。”</p><p><img src="https://pic4.zhimg.com/50/v2-bc98924943d9ecad0e7dc53ed6a30e35_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-bc98924943d9ecad0e7dc53ed6a30e35_r.jpg?source=1940ef5c" alt="img">《LIFE》中原子弹之父奥本海默的头像</p><p>1999年，世纪之交，坂本龙一写了一出歌剧《LIFE》（生活），蕴藏了许多与环境问题、社会问题相关的信息，比如核武器原子弹之父奥本海默的头像投影在巨大屏幕上。坂本期待经过20世纪的战争和灾难，数以亿计的人因此死去，到了新世纪，人类也会变得更明智一些。</p><p><img src="https://pic1.zhimg.com/50/v2-e5dde5b547df358728e3f2f458e86c50_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/80/v2-e5dde5b547df358728e3f2f458e86c50_1440w.jpg?source=1940ef5c" alt="img">坂本龙一拍摄于911事件</p><p>可是21世纪的头一年，他在纽约亲历911事件，生活陷入恐慌之中。很多人担心恐怖分子会用核武器发动第二波攻击，为此坂本龙一买了一辆越野车，里面储备了一个月的水和粮食，打算随时逃难，还买了很多防毒面具，分送别人，也送了前妻一个。</p><p>12月，他和村上龙等好友一起出版了一本评论集《反战》。</p><p><img src="https://pic4.zhimg.com/50/v2-64b5387c9c2001a6b0483f0c91d08a9b_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-64b5387c9c2001a6b0483f0c91d08a9b_r.jpg?source=1940ef5c" alt="img">《Chasm》专辑封面</p><p>21世纪，他发行的第一张专辑就是《Chasm》（意为裂痕、断层），专辑发行于2004年，这前一年美军进攻伊拉克。专辑充满着被愤怒驱使的心情，比如第一首歌就是说唱，由韩国说唱歌手MC Sniper联合演绎，歌词写着“搬运因为饥饿呻吟的老人，被恐怖中的不安和危险拽着的你和我……”</p><p>“虽然一般大众走上了全球各地的街头，质疑美军进攻的动机并不单纯，但那些媒体或专业人士，却对此一声不吭。我真的看不下去，每天都很痛心，想着这是开什么玩笑。”</p><p><img src="https://pic1.zhimg.com/50/v2-d90d7d6a2ba3733ef7413c857d2ddb01_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-d90d7d6a2ba3733ef7413c857d2ddb01_r.jpg?source=1940ef5c" alt="img">2008年格陵兰岛之旅</p><p><video class="ztext-gif GifPlayer-gif2mp4" src="https://vdn1.vzuu.com/SD/9cf3250e-239f-11eb-93b5-a2d9c4dc5e08.mp4?disable_local_cache=1&amp;auth_key=1618591340-0-0-d3cacd64854417005b644b885f73f3db&amp;f=mp4&amp;bu=pico&amp;expiration=1618591340&amp;v=hw" data-thumbnail="https://pic2.zhimg.com/50/v2-bd9c5c6acbc371a2fa7cd5ee2e16fc94_hd.jpg?source=1940ef5c" poster="https://pic2.zhimg.com/50/v2-bd9c5c6acbc371a2fa7cd5ee2e16fc94_hd.jpg?source=1940ef5c" data-size="normal" preload="metadata" loop playsinline></video></p><p><img src="https://pic2.zhimg.com/50/v2-bd9c5c6acbc371a2fa7cd5ee2e16fc94_hd.jpg?source=1940ef5c" alt="img"></p><p>坂本龙一把录音机放进冰川，“我在把声音钓上来”</p><p>坂本龙一对人为灾难和环境问题的思考，在2008年的格陵兰之旅中，得到了某种解答。</p><p>当时是一个艺术项目，邀请艺术家去格陵兰岛，直观地看全球暖化的后果。见到数量惊人的海水和冰山，坂本内心受到很大冲击。</p><p>“当人类加诸大自然的负担一超出大自然容许的范围，受害的是人类，大自然不会感到任何困扰。生活在冰山和海水的世界的那期间，我不断感到人类是多么微不足道。”</p><p>格陵兰之旅也深刻改变了他正在创作的专辑《Out of Noise》（2009），使用了北极冰雪融化声、流水声，他让这些原始声音直接排列，崭新的音乐也逐渐成形。</p><p><img src="https://pic1.zhimg.com/50/v2-bc0919f122ef6477e2304423f9e72413_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-bc0919f122ef6477e2304423f9e72413_r.jpg?source=1940ef5c" alt="img">坂本龙一和东北青少年管弦乐团</p><p>2011年的日本大地震以及核泄漏事件，对坂本龙一影响深远，他招募受灾地区的孩子，组建了一支东北青少年管弦乐团，亲自教授，把他们带进音乐世界。</p><p>直到2019年的采访中，他仍然说“事件带给我的震动至今还在。那种震动究竟是什么，我应该怎么做？我还没能找到答案，它们也影响着我的创作”。</p><p>《坂本龙一：终曲》也记录了他寻找答案的过程。</p><p><strong>以下是纪录片导演史蒂芬的自述。</strong></p><p><img src="https://pic2.zhimg.com/50/v2-3077963a6dd802013f81ee8e57a903e6_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-3077963a6dd802013f81ee8e57a903e6_r.jpg?source=1940ef5c" alt="img"></p><p><img src="https://pic2.zhimg.com/50/v2-930f2137031b6be5bec2747f3aaa7d5d_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-930f2137031b6be5bec2747f3aaa7d5d_r.jpg?source=1940ef5c" alt="img"></p><p><strong>自述  史蒂芬·野村·斯奇博</strong></p><p> <strong>福岛核泄露事故后，</strong></p><p> <strong>我见到了不一样的坂本龙一</strong> </p><p>1990年前后，我和坂本龙一，几乎在同一时间从东京搬到了纽约。</p><p>我是1970年出生在东京，妈妈是日本人，爸爸是美国人。我还是孩子的时候，整个东京，我感觉YMO的音乐无处不在。我一直是坂本龙一的粉丝。</p><p>2011年，日本东太平洋发生9级地震，继而发生海啸，福岛核电站放射性物质泄漏，它在当时是世界上最大的在役核电站。家乡的一切发生了翻天覆地的变化。</p><p>2012年5月，我在纽约的一次有关福岛核灾难的活动中见到了坂本龙一，当时是一位京都大学的核物理学家，来做核污染的演讲。眼前的坂本龙一，和我印象中的完全不一样了 。</p><p><img src="https://pic2.zhimg.com/50/v2-0a6dd64af290bdbe7cb4019f7055f417_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-0a6dd64af290bdbe7cb4019f7055f417_r.jpg?source=1940ef5c" alt="img">YMO时期，坂本龙一做出机械感的电子音乐</p><p>在我的印象中，他是YMO乐队最英俊的成员。80年代，日本经济腾飞，科技迅速发展，从战后阴影中走出来，大家对未来有一种梦幻的向往，YMO的音乐带着时髦的机械感，他就像一个时代典型，代表着科技能带来的希望和幸福。</p><p>而眼前的坂本龙一，年纪大了，他显得有些懊悔，意识到技术也会给我们带来很多麻烦。</p><p><img src="https://pic4.zhimg.com/50/v2-8e472d9a609550608f33f5093e621131_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic4.zhimg.com/v2-8e472d9a609550608f33f5093e621131_r.jpg?source=1940ef5c" alt="img">坂本龙一在反对重启核电站的活动现场</p><p>在这个活动上，我第一次知道坂本龙一对环境问题、核问题有自己的立场。我也得知他计划于2012年7月在东京举办一场名为“无核”的音乐节。日本主流媒体对于他反对核污染的立场感到不安，因为他太有名了。</p><p>这些媒体不跟进报道、保持沉默，而我是一个住在纽约的独立电影制作人，我觉得我应该去记录它。</p><p>我真的不知道坂本龙一为什么会答应。他后来告诉我，看过我的另一部音乐纪录片，关于埃里克·克莱普顿（Eric Clapton），他很喜欢。</p><p>而且我猜测他的确希望有人能在福岛核事故之后，帮他讲述自己的故事。也许他认为我能以国际化的视角去讲述。</p><p><img src="https://pic1.zhimg.com/50/v2-846a16e4582b9d11b9314188f3e56595_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-846a16e4582b9d11b9314188f3e56595_r.jpg?source=1940ef5c" alt="img"></p><p><video class="ztext-gif GifPlayer-gif2mp4" src="https://vdn1.vzuu.com/SD/29d41184-232a-11eb-9a60-c6446caf7a05.mp4?disable_local_cache=1&amp;auth_key=1618591342-0-0-22d3ebcfd6d98f26c03931998e1bb07e&amp;f=mp4&amp;bu=pico&amp;expiration=1618591342&amp;v=hw" data-thumbnail="https://pic4.zhimg.com/50/v2-1f4dc93ea8a82fff2b4b30096702291e_hd.jpg?source=1940ef5c" poster="https://pic4.zhimg.com/50/v2-1f4dc93ea8a82fff2b4b30096702291e_hd.jpg?source=1940ef5c" data-size="normal" preload="metadata" loop playsinline></video></p><p><img src="https://pic4.zhimg.com/50/v2-1f4dc93ea8a82fff2b4b30096702291e_hd.jpg?source=1940ef5c" alt="img"></p><p>坂本龙一为灾区人们演奏</p><p> <strong>灾难之后，我们能做些什么</strong> </p><p>面对灾难，我们无能为力，只能试着找出自己能做什么。坂本龙一成为了一个积极活动的音乐家，而我为他拍了一部纪录片。</p><p>在岩手县一个叫陆前高田的小镇，很多人在海啸中丧生，是一个重灾区。2012年12月，坂本龙一去那里为当地人表演。</p><p>地震发生在2011年3月，此时是在一年零9个月后，但一些人告诉我们，在坂本龙一演出的时候，他们终于可以真正入睡了。</p><p>当时那个情境很打动教授，但是他努力让自己冷静下来，为了使人们从音乐中感到放松，演奏者不能够太情绪化。福岛核事故之后，我们已知的世界似乎要走到尽头，好像进入了一个时代尾声。</p><p>我想展现坂本龙一是如何用艺术回应灾难。</p><p><video class="ztext-gif GifPlayer-gif2mp4" src="https://vdn1.vzuu.com/SD/342fdca8-2357-11eb-9ba8-86b142f84435.mp4?disable_local_cache=1&amp;auth_key=1618591342-0-0-4dcb39c0fe4f6fa4a4c51491cae18e27&amp;f=mp4&amp;bu=pico&amp;expiration=1618591342&amp;v=hw" data-thumbnail="https://pic4.zhimg.com/50/v2-59b1d24267355075e5bd337817c1a68b_hd.jpg?source=1940ef5c" poster="https://pic4.zhimg.com/50/v2-59b1d24267355075e5bd337817c1a68b_hd.jpg?source=1940ef5c" data-size="normal" preload="metadata" loop playsinline></video></p><p><img src="https://pic4.zhimg.com/50/v2-59b1d24267355075e5bd337817c1a68b_hd.jpg?source=1940ef5c" alt="img"></p><p>这部电影的第一个场景，是坂本龙一在弹奏一架被海啸损坏的钢琴，他觉得走音的钢琴声很美。</p><p>这个场景基本囊括了所有这部电影在探索的主题：关于一个人克服困难、并开始创造新的美妙音乐的故事；他最终拥抱了生活，但同时，他对世界上所有正在分崩离析的事物有着非常敏锐的意识。</p><p><img src="https://pic4.zhimg.com/50/v2-7e71918c6299c5e834566d795b826a56_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-7e71918c6299c5e834566d795b826a56_r.jpg?source=1940ef5c" alt="img"></p><p> <strong>患癌症后，他鼓励我继续拍下去</strong> </p><p>拍摄期间，2014年，他患上癌症。</p><p>得知他的病情后不久，他允许我去采访他。我不忍心继续打扰，但他说你应该拍下来。这是整个拍摄中最痛苦的部分。我采访了他很多内容，因为癌在他的咽喉，我们担心他以后不能说话。当时坂本龙一先生和他家人，不希望除了我以外的任何人来他们家拍摄。</p><p>当时他的儿子刚刚大学毕业，是个很有天赋的电影制作人，我一个人在他们家拍摄时，他就帮我打灯、收音。我就跟他说，你为什么不直接自己拍呢？</p><p>我很快就发现，他拍的镜头非常好，有一种非常温柔的关系在里面。后来他一听见父亲弹琴的声音，就像消防员一样，拿着相机冲过去拍。家里面的很多镜头是坂本先生的儿子拍的。后来坂本先生的身体恢复了一些，我会带一个小小的团队来，他的儿子也会成为团队一员。</p><p><img src="https://pic3.zhimg.com/50/v2-614651f5fa52ef1e3567f9b3307c7351_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-614651f5fa52ef1e3567f9b3307c7351_r.jpg?source=1940ef5c" alt="img">坂本龙一纽约家附近的街区</p><p>solari坂本龙一 - async</p><p>我曾经尝试导演坂本龙一，但是从来行不通。他太聪明了，一意识到我在做些安排，他就会毁了它。他相信自然流露是最好的，你就是在诚实地表达。</p><p>也的确如此，我之前一直想以新的音乐的诞生作为电影的尾声，事情就自然发生了。</p><p>那天我们已经完成拍摄，只想从坂本龙一身后补拍一个在弹琴的镜头，他说，那我就随便弹了。他开始弹《Solari》，这是他写的一首新歌，他第一次在别人面前演奏这首曲子。</p><p>那其实是我等待了5年的时刻。</p><p><img src="https://pic4.zhimg.com/50/v2-e0cc88e00dc5b21f2feb1c03b68a2557_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-e0cc88e00dc5b21f2feb1c03b68a2557_r.jpg?source=1940ef5c" alt="img"></p><p>拍摄过程中，有很多回忆，最美好的就是和坂本龙一待在一个小房间，他在一架钢琴前作曲。</p><p>那整个夏天他都投入在《异步》这张新专辑的创作中。我们每个周末去拜访他，会谈论他的想法、他的生活，最妙的是，有时他有了灵感就会突然开始弹奏。</p><p>音乐太美了，而且他就坐在那儿。</p><p><img src="https://pic4.zhimg.com/50/v2-7ac5889920fbcf1e722c31228e38955e_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-7ac5889920fbcf1e722c31228e38955e_r.jpg?source=1940ef5c" alt="img"></p><p> <strong>“我想让观众感受</strong> </p><p> <strong>坂本龙一是如何听到这个世界”</strong> </p><p>我们都叫坂本龙一“教授”，我想把他的理念，也融入到纪录片的制作中。</p><p>坂本龙一是一个极简主义者，他总是说少即是多。所以电影中有很多沉默的时刻，有时沉默是最有力的。</p><p><video class="ztext-gif GifPlayer-gif2mp4" src="https://vdn1.vzuu.com/SD/95acbe4c-237f-11eb-a25a-ea37c03d7100.mp4?disable_local_cache=1&amp;auth_key=1618591343-0-0-c53a02208d600bf05e1bcdb622ad155d&amp;f=mp4&amp;bu=pico&amp;expiration=1618591343&amp;v=hw" data-thumbnail="https://pic1.zhimg.com/50/v2-8cd6ed58fda9a68145d74c8b82dd76e9_hd.jpg?source=1940ef5c" poster="https://pic1.zhimg.com/50/v2-8cd6ed58fda9a68145d74c8b82dd76e9_hd.jpg?source=1940ef5c" data-size="normal" preload="metadata" loop playsinline></video></p><p><img src="https://pic1.zhimg.com/50/v2-8cd6ed58fda9a68145d74c8b82dd76e9_hd.jpg?source=1940ef5c" alt="img"></p><p>《东京旋律》中坂本龙一弹奏《圣诞快乐劳伦斯》</p><p>这部电影有许多片段，在过去和现在来回穿梭，剪辑上还会从世界一个地方跳到另一个地方，因为我觉得这是坂本龙一的思想特点之一。</p><p>电影中我穿插使用了一些1985年，法国摄影师Elizabeth拍摄的坂本龙一纪录片《东京旋律》，那就像一个时间胶囊，当时他弹奏《圣诞快乐劳伦斯》的速度更快，钢琴音调也调得更高，他说话也更快。当时和现在的对比很有趣，也很美。</p><p>1987年，坂本龙一就出过一张专辑《Neo Geo》（新地理），其中有巴厘岛的音乐，有日本冲绳的，也有来源于非洲的音乐，对他来说，这是一整个平坦的世界。电影中也是如此，上一刻在非洲，下一个场景就到了格陵兰岛。</p><p><video class="ztext-gif GifPlayer-gif2mp4" src="https://vdn1.vzuu.com/SD/4ab36892-2329-11eb-8fc6-ba04eef90046.mp4?disable_local_cache=1&amp;auth_key=1618591343-0-0-8b3ae62a2ead7d09311707bd391cf0ee&amp;f=mp4&amp;bu=pico&amp;expiration=1618591343&amp;v=hw" data-thumbnail="https://pic4.zhimg.com/50/v2-1e1a9583a71a47436a6555586a559a25_hd.jpg?source=1940ef5c" poster="https://pic4.zhimg.com/50/v2-1e1a9583a71a47436a6555586a559a25_hd.jpg?source=1940ef5c" data-size="normal" preload="metadata" loop playsinline></video></p><p><img src="https://pic4.zhimg.com/50/v2-1e1a9583a71a47436a6555586a559a25_hd.jpg?source=1940ef5c" alt="img"></p><p>坂本龙一在福岛核事故后的灾区，电影中此处可听见测量放射污染仪器的鸣叫</p><p>我把电影的整体节奏放慢，让声音能够停留，被感觉到。这种方式也跟我和坂本龙一一起去福岛核污染区的经验有关。</p><p>那儿实际上非常平静，有鸟类，但没有人烟，我感到最恐怖的是，我一点也感觉不到危险。人的五感是没法感知到核污染的，只能通过科技的东西探测，无色无味，我们人类制造出来了一种危险，我们自己无法感知。</p><p>我希望通过这部电影，让观众感受到坂本龙一是如何听到这个世界的。</p><p><img src="https://pic1.zhimg.com/50/v2-2130bcf1c637f00973b67efaff2868dd_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic1.zhimg.com/v2-2130bcf1c637f00973b67efaff2868dd_r.jpg?source=1940ef5c" alt="img">坂本龙一在新专辑《异步》的演奏会上</p><p><img src="https://pic2.zhimg.com/50/v2-072846e4a0b0db42ccab7f40ff91cbdf_hd.jpg?source=1940ef5c" alt="img"><img src="https://pic2.zhimg.com/v2-072846e4a0b0db42ccab7f40ff91cbdf_r.jpg?source=1940ef5c" alt="img"></p><p>龙一相信所有的声音都是音乐性的——即使是环境声。他收录各种声音，把它们带入专辑。比如，把麦克风挂在家里的墙上，让他的房子变成像一件乐器。这个理念启发了他最新的作品，以及我们的剪辑方式。</p><p>破碎的钢琴声、测定放射能量仪器的哀嚎声、北极冰层融化的声音，以及坂本龙一弹奏美妙的旋律——所有这些，像乐句一样被组合。我们根据声音来剪辑电影，希望它就像一首很长的乐曲。</p><p>电影的结尾，他创作出了美妙的新音乐，然后又回到生活中，天气很冷，他说要动动手指，保持温暖，继续创作。</p><p>所以平和无味的日常隐藏你我的爆裂无声也是浪漫主义的复生吧，枯燥无聊的我收拾欲望成为一个通透的人还任重而道远啊，也是无力的自嘲罢了，好在我还能意识到这点，没有妄自尊大。</p><p>最后在文章末尾附上龙一先生的经典作品，不求有所悟，但求有所慰藉，毕竟生活给予各人的体悟没必要再在一首简单却悠长的作品里了。</p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=4899152&auto=1&height=66"></iframe>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 艺术家 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>四种JavaEE架构简介</title>
      <link href="2020/11/29/%E5%9B%9B%E7%A7%8DJavaEE%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B/"/>
      <url>2020/11/29/%E5%9B%9B%E7%A7%8DJavaEE%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="四种JavaEE架构简介"><a href="#四种JavaEE架构简介" class="headerlink" title="四种JavaEE架构简介"></a><a href="https://www.cnblogs.com/shaohsiung/p/9552990.html">四种JavaEE架构简介</a></h2><h1 id="1-传统三层架构"><a href="#1-传统三层架构" class="headerlink" title="1. 传统三层架构"></a>1. 传统三层架构</h1><p>配图是一个基于MVC的三层架构, 大致可以分成表现层, 业务层和持久层</p><p>表现层负责接收请求和转发请求</p><p>业务层主要负责处理请求, 值得注意的是事务管理, 日志记录等操作通常也是封装在这层中</p><p>持久层主要负责数据库与实体之间的操作</p><p>我们可以使用框架来简化各层的开发, 例如表现层使用SpringMVC或Strut2, 持久层使用Mybatis或Hibernate, 使用Spring管理三层之间的关系</p><p><img src="https://images2018.cnblogs.com/blog/1471979/201808/1471979-20180829105155049-481908758.png" alt="img"></p><h1 id="2-集群架构"><a href="#2-集群架构" class="headerlink" title="2. 集群架构"></a>2. 集群架构</h1><p>集群属于水平拓展.</p><p>传统三层架构中存在许多问题, 比如业务层中不同模块占用系统资源的比例相差太大, 导致占用系统资源, 可以使用集群解决这类问题.</p><p>在集群架构, 一般由这么一个重要的角色, 那就是反向代理服务器, 它的主要任务是实现负载均衡, 接收用户请求, 转发到目标服务器.</p><p>反向代理服务器可以使用nginx实现.</p><p><img src="https://images2018.cnblogs.com/blog/1471979/201808/1471979-20180829103451096-37051288.png" alt="img"></p><h1 id="3-分布式架构"><a href="#3-分布式架构" class="headerlink" title="3. 分布式架构"></a>3. 分布式架构</h1><p>多个模块完成一个功能.</p><p>每个模块都可以搭建集群 -&gt; 高可用</p><p><img src="https://images2018.cnblogs.com/blog/1471979/201808/1471979-20180829104315263-150430733.png" alt="img"></p><h1 id="4-微服务架构"><a href="#4-微服务架构" class="headerlink" title="4. 微服务架构"></a>4. 微服务架构</h1><p>根据产品的业务功能模块来划分服务的种类, 这属于垂直划分.</p><p>客户端可以通过基于HTTP或RPC的方式来调用微服务, 这样做的目的是为了降低调用所产生的性能开销.</p><p>每个模块也可搭建集群 -&gt; 高可用</p><p><img src="https://images2018.cnblogs.com/blog/1471979/201808/1471979-20180829104515114-760628485.png" alt="img"></p><h2 id="三种轻量级API调用服务-使用service-gateway和service-register实现客户端与微服务之间的调用-实现通信"><a href="#三种轻量级API调用服务-使用service-gateway和service-register实现客户端与微服务之间的调用-实现通信" class="headerlink" title="三种轻量级API调用服务 - 使用service gateway和service register实现客户端与微服务之间的调用(实现通信)"></a>三种轻量级API调用服务 - 使用service gateway和service register实现客户端与微服务之间的调用(实现通信)</h2><p>SOA实现两个系统之间通信的三种方式</p><p><img src="https://images2018.cnblogs.com/blog/1471979/201808/1471979-20180829105440188-18517504.png" alt="img"></p><h2 id="dubbo体系结构"><a href="#dubbo体系结构" class="headerlink" title="dubbo体系结构:"></a>dubbo体系结构:</h2><p><img src="https://images2018.cnblogs.com/blog/1471979/201808/1471979-20180829105514263-1906080560.png" alt="img"></p><h2 id="一个典型的基于SOA的电商项目架构"><a href="#一个典型的基于SOA的电商项目架构" class="headerlink" title="一个典型的基于SOA的电商项目架构:"></a>一个典型的基于SOA的电商项目架构:</h2><p><img src="https://images2018.cnblogs.com/blog/1471979/201808/1471979-20180829105035906-521553459.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kmp算法解析&lt;kmp算法解析&gt;</title>
      <link href="2020/11/19/kmp%E7%AE%97%E6%B3%95%E8%A7%A3%E6%9E%90/"/>
      <url>2020/11/19/kmp%E7%AE%97%E6%B3%95%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>有些算法，适合从它产生的动机，如何设计与解决问题这样正向地去介绍。但KMP算法真的不适合这样去学。最好的办法是先搞清楚它所用的数据结构是什么，再搞清楚怎么用，最后为什么的问题就会有恍然大悟的感觉。我试着从这个思路再介绍一下。大家只需要记住一点，PMT是什么东西。然后自己临时推这个算法也是能推出来的，完全不需要死记硬背。</p><p>KMP算法的核心，是一个被称为部分匹配表(Partial Match Table)的数组。我觉得理解KMP的最大障碍就是很多人在看了很多关于KMP的文章之后，仍然搞不懂PMT中的值代表了什么意思。这里我们抛开所有的枝枝蔓蔓，先来解释一下这个数据到底是什么。</p><p>对于字符串“abababca”，它的PMT如下表所示：</p><p><img src="https://pic1.zhimg.com/50/v2-e905ece7e7d8be90afc62fe9595a9b0f_hd.jpg?source=1940ef5c"><img src="https://pic1.zhimg.com/80/v2-e905ece7e7d8be90afc62fe9595a9b0f_1440w.jpg?source=1940ef5c"></p><p>就像例子中所示的，如果待匹配的模式字符串有8个字符，那么PMT就会有8个值。</p><p>我先解释一下字符串的前缀和后缀。如果字符串A和B，存在A=BS，其中S是任意的非空字符串，那就称B为A的前缀。例如，”Harry”的前缀包括{”H”, ”Ha”, ”Har”, ”Harr”}，我们把所有前缀组成的集合，称为字符串的前缀集合。同样可以定义后缀A=SB， 其中S是任意的非空字符串，那就称B为A的后缀，例如，”Potter”的后缀包括{”otter”, ”tter”, ”ter”, ”er”, ”r”}，然后把所有后缀组成的集合，称为字符串的后缀集合。要注意的是，字符串本身并不是自己的后缀。</p><p>有了这个定义，就可以说明PMT中的值的意义了。<strong>PMT中的值是字符串的前缀集合与后缀集合的交集中最长元素的长度</strong>。例如，对于”aba”，它的前缀集合为{”a”, ”ab”}，后缀 集合为{”ba”, ”a”}。两个集合的交集为{”a”}，那么长度最长的元素就是字符串”a”了，长 度为1，所以对于”aba”而言，它在PMT表中对应的值就是1。再比如，对于字符串”ababa”，它的前缀集合为{”a”, ”ab”, ”aba”, ”abab”}，它的后缀集合为{”baba”, ”aba”, ”ba”, ”a”}， 两个集合的交集为{”a”, ”aba”}，其中最长的元素为”aba”，长度为3。</p><p>好了，解释清楚这个表是什么之后，我们再来看如何使用这个表来加速字符串的查找，以及这样用的道理是什么。如图 1.12 所示，要在主字符串”ababababca”中查找模式字符串”abababca”。如果在 j 处字符不匹配，那么由于前边所说的模式字符串 PMT 的性质，主字符串中 i 指针之前的 PMT[j −1] 位就一定与模式字符串的第 0 位至第 PMT[j−1] 位是相同的。这是因为主字符串在 i 位失配，也就意味着主字符串从 i−j 到 i 这一段是与模式字符串的 0 到 j 这一段是完全相同的。而我们上面也解释了，模式字符串从 0 到 j−1 ，在这个例子中就是”ababab”，其前缀集合与后缀集合的交集的最长元素为”abab”， 长度为4。所以就可以断言，主字符串中i指针之前的 4 位一定与模式字符串的第0位至第 4 位是相同的，即长度为 4 的后缀与前缀相同。这样一来，我们就可以将这些字符段的比较省略掉。具体的做法是，保持i指针不动，然后将j指针指向模式字符串的PMT[j −1]位即可。</p><p>简言之，以图中的例子来说，在 i 处失配，那么主字符串和模式字符串的前边6位就是相同的。又因为模式字符串的前6位，它的前4位前缀和后4位后缀是相同的，所以我们推知主字符串i之前的4位和模式字符串开头的4位是相同的。就是图中的灰色部分。那这部分就不用再比较了。</p><p><img src="https://pic1.zhimg.com/50/v2-03a0d005badd0b8e7116d8d07947681c_hd.jpg?source=1940ef5c"><img src="https://pic1.zhimg.com/80/v2-03a0d005badd0b8e7116d8d07947681c_1440w.jpg?source=1940ef5c"></p><p>有了上面的思路，我们就可以使用PMT加速字符串的查找了。我们看到如果是在 j 位 失配，那么影响 j 指针回溯的位置的其实是第 j −1 位的 PMT 值，所以为了编程的方便， 我们不直接使用PMT数组，而是将PMT数组向后偏移一位。我们把新得到的这个数组称为next数组。下面给出根据next数组进行字符串匹配加速的字符串匹配程序。其中要注意的一个技巧是，在把PMT进行向右偏移时，第0位的值，我们将其设成了-1，这只是为了编程的方便，并没有其他的意义。在本节的例子中，next数组如下表所示。</p><p><img src="https://pic2.zhimg.com/50/v2-40b4885aace7b31499da9b90b7c46ed3_hd.jpg?source=1940ef5c"><img src="https://pic2.zhimg.com/80/v2-40b4885aace7b31499da9b90b7c46ed3_1440w.jpg?source=1940ef5c"></p><p>具体的程序如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">KMP</span><span class="params">(<span class="keyword">char</span> * t, <span class="keyword">char</span> * p)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>; </span><br><span class="line"><span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="built_in">strlen</span>(t) &amp;&amp; j &lt; <span class="built_in">strlen</span>(p))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (j == <span class="number">-1</span> || t[i] == p[j]) </span><br><span class="line">&#123;</span><br><span class="line">i++;</span><br><span class="line">           j++;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">else</span> </span><br><span class="line">           j = next[j];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (j == <span class="built_in">strlen</span>(p))</span><br><span class="line">       <span class="keyword">return</span> i - j;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">       <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>好了，讲到这里，其实KMP算法的主体就已经讲解完了。你会发现，其实KMP算法的动机是很简单的，解决的方案也很简单。远没有很多教材和算法书里所讲的那么乱七八糟，只要搞明白了PMT的意义，其实整个算法都迎刃而解。</p><p>现在，我们再看一下如何编程快速求得next数组。其实，求next数组的过程完全可以看成字符串匹配的过程，即以模式字符串为主字符串，以模式字符串的前缀为目标字符串，一旦字符串匹配成功，那么当前的next值就是匹配成功的字符串的长度。</p><p>具体来说，就是从模式字符串的第一位(注意，不包括第0位)开始对自身进行匹配运算。 在任一位置，能匹配的最长长度就是当前位置的next值。如下图所示。</p><p><img src="https://pic1.zhimg.com/50/v2-645f3ec49836d3c680869403e74f7934_hd.jpg?source=1940ef5c"><img src="https://pic1.zhimg.com/80/v2-645f3ec49836d3c680869403e74f7934_1440w.jpg?source=1940ef5c"></p><p><img src="https://pic4.zhimg.com/50/v2-06477b79eadce2d7d22b4410b0d49aba_hd.jpg?source=1940ef5c"><img src="https://pic4.zhimg.com/80/v2-06477b79eadce2d7d22b4410b0d49aba_1440w.jpg?source=1940ef5c"></p><p><img src="https://pic4.zhimg.com/50/v2-8a1a205df5cad7ab2f07498484a54a89_hd.jpg?source=1940ef5c"><img src="https://pic4.zhimg.com/80/v2-8a1a205df5cad7ab2f07498484a54a89_1440w.jpg?source=1940ef5c"></p><p><img src="https://pic1.zhimg.com/50/v2-f2b50c15e7744a7b358154610204cc62_hd.jpg?source=1940ef5c"><img src="https://pic1.zhimg.com/80/v2-f2b50c15e7744a7b358154610204cc62_1440w.jpg?source=1940ef5c"></p><p><img src="https://pic4.zhimg.com/50/v2-bd42e34a9266717b63706087a81092ac_hd.jpg?source=1940ef5c"><img src="https://pic4.zhimg.com/80/v2-bd42e34a9266717b63706087a81092ac_1440w.jpg?source=1940ef5c"></p><p>求next数组值的程序如下所示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNext</span><span class="params">(<span class="keyword">char</span> * p, <span class="keyword">int</span> * next)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">next[<span class="number">0</span>] = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (i &lt; <span class="built_in">strlen</span>(p))</span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">if</span> (j == <span class="number">-1</span> || p[i] == p[j])</span><br><span class="line">&#123;</span><br><span class="line">++i;</span><br><span class="line">++j;</span><br><span class="line">next[i] = j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">j = next[j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>至此，KMP算法就全部介绍完了。<strong>粗体</strong></p><p><em><strong>对于要考研的小伙伴来说，这章节在串string那一块算重点，可以结合王道考研笔记结合起来学习。</strong></em></p>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rails学习笔记-11.2</title>
      <link href="2020/02/12/%E2%80%9CRail%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E2%80%9D/"/>
      <url>2020/02/12/%E2%80%9CRail%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E2%80%9D/</url>
      
        <content type="html"><![CDATA[<p>11.2 迭代F2:建立一个基于Ajax的购物车</p><p>开始是按照书里面写的，创建create.js.rjs，</p><p>网上查了，需要使用protype-rails gem，于是安装了，但是页面点击后ajax没有效果，需要手动刷新后才能出现。</p><p>于是在网上查了,由于默认使用jquery，所以就改成了jquery的，创建create.js.erb，内容为$(‘#cart’).html(“&lt;%= escape_javascript(render(@cart)) %&gt;”);</p><p>按照网上仁兄的做法来的：</p><p>1.\app\views\layouts\application.html.erb<br>&lt;%= javascript_include_tag :defaults %&gt; to &lt;%= javascript_include_tag “application” %&gt;<br>2.app/views/line_items/create.js.rjs 成create.js.erb，并修改内容：<br>$(‘#cart’).html(“&lt;%= escape_javascript(render(@cart)) %&gt;”);</p><p>3.修改line_items_controller中的create方法， 加入format.js</p><p>传送门:<a href="http://ruby-china.org/topics/6154" target="_blank">RubyChina</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rails </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
