<!DOCTYPE html>
<html>



<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=426342234&auto=1&height=66"></iframe>




<script src="https://cdn.jsdelivr.net/gh/zyoushuo/Blog/hexo/js/sakura.js"></script>



<script src="https://cdn.jsdelivr.net/gh/zyoushuo/Blog/hexo/js/mouse_slide.js"></script> 
<script src="https://cdn.jsdelivr.net/gh/zyoushuo/Blog/hexo/js/mouse_click.js"></script>



  <!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  
  <title>MYSQL主从同步错误解决 - 齐雨争</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  
  <meta name="keywords" content=IT,MYSQL,数据库>
  
    <meta name="description" content="GEISHA">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.ico?v=1.02">
  
  
    <link rel="alternate" href="../../../../atom.xml " title="齐雨争" type="application/atom+xml">
  

  
<link rel="stylesheet" href="../../../../css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>



  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="../../../../index.html" class="logo">齐雨争</a>
    <div class="subtitle">穿梭时间的画面的钟，从反方向开始移动</div>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="../../../../index.html" class="menu-item-link">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="../../../../archives" class="menu-item-link">Archives</a>
        </li>
      
        <li class="menu-item">
          <a href="../../../../about" class="menu-item-link">About</a>
        </li>
      
        <li class="menu-item">
          <a href="../../../../life" class="menu-item-link">life</a>
        </li>
      
    </ul>
  </nav>
</header>
<article class="post">
  <div class="post-title">
    <h1 class="article-title">MYSQL主从同步错误解决</h1>
  </div>
   <div class="post-meta">
    <span class="post-time">2018-11-15</span>
  </div>
  <div class="post-content">
    <p>首先，如果遇到主键冲突：<br><code>Last_SQL_Error: Error &#39;Duplicate entry &#39;1001-164761-0&#39; for key &#39;PRIMARY&#39;&#39; on query. Default database: &#39;bug&#39;. Query: &#39;insert into misdata (uid,mid,pid,state,mtime) values (164761,1001,0,-1,1262623560)&#39;</code> </p>
<p><strong>A.可以先将冲突的记录删除，然后再进行一下方法：</strong></p>
<p>进入主库锁表，</p>
<p>FLUSH TABLES WITH READ LOCK;</p>
<span id="more"></span>
<p>mysql&gt;show master status;</p>
<p>+——————-+———–+————–+——————+</p>
<p>| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</p>
<p>+——————-+———–+————–+——————+</p>
<p>| ufo.000063 | 159164526 | | |</p><br>+——————-+———–+————–+——————+<p></p>
<p>1 row in set (0.00 sec)</p><br>进入从库<p></p>
<p>mysql&gt;slave stop;</p>
<p>mysql&gt;change master to master_log_file=’ufo.000063’, master_log_pos=159164526;</p>
<p>完成上面这些后</p>
<p>mysql&gt;slave start;</p>
<p>回到主库</p>
<p>unlock tables; 解锁</p>
<p>回到从库查看</p>
<p>show slave status \G;</p>
<p><strong>B.另外，可以在热备时跳过冲突的记录：</strong></p>
<p>slave stop;</p>
<p>set global sql_slave_skip_counter=10;  //跳过10个错误</p>
<p>slave start;</p>
<p>show slave status \G;</p>
<p><strong>C.修改从库的/etc/my.cnf文件</strong></p>
<p>在[mysqld]下面加入slave-skip-errors = 1062 (忽略所有的1062错误)</p>
<p>重启下从库的mysql</p>
<p><strong>D.修改binlog_format的格式为mixed</strong></p>
<p>进入从库查看show global variables like ‘binlog_format’，如果是statement，修改从库的 my.cfg，在[mysqld]下面添加binlog_format=mixed，然后重启数据库</p>

  </div>
  <div class="post-footer">
    
      <ul class="post-tag-list" itemprop="keywords"><li class="post-tag-list-item"><a class="post-tag-list-link" href="../../../../tags/IT/" rel="tag">IT</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="../../../../tags/MYSQL/" rel="tag">MYSQL</a></li><li class="post-tag-list-item"><a class="post-tag-list-link" href="../../../../tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>
    

    <a href="#top" class="top">Back to Top</a>
  </div>
</article>
<footer>
  &copy; 2021
  <span class="author">
    齐雨争
  </span>
</footer>
    </div>








  </body>






</html>