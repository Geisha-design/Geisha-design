{"title":"","date":"2022-01-04T16:54:21.131Z","updated":"2022-01-04T16:46:48.518Z","comments":true,"path":"api/pages/source/extension/letter/index.js","covers":null,"excerpt":"","content":"function getDateFormat(lang) {\n  if (typeof lang === 'string') {\n    if (lang.startsWith('zh')) {\n      return 'YYYY年MM月DD日 ddd A h:mm:ss';\n    } else {\n      return 'dddd, Do MMM. YYYY, h:mm:ss A';\n    }\n  }\n  return '';\n}\n\nfunction fillBrand(data) {\n  var brand = document.querySelector('#brand');\n  var name = document.querySelector('#name');\n  var position = document.querySelector('#position');\n  var date = document.querySelector('#date');\n  var email = document.querySelector('#email');\n  var phone = document.querySelector('#phone');\n  var address = document.querySelector('#address');\n  var www = document.querySelector('#www');\n  var linkedin = document.querySelector('#linkedin');\n  var github = document.querySelector('#github');\n  var body = document.querySelector('#body');\n  var signal = document.querySelector('#signal');\n\n  data.name && (name.innerHTML = data.name);\n  data.email && (email.innerHTML = data.email);\n  data.phone && (phone.innerHTML = data.phone);\n  data.address && (address.innerHTML = data.address);\n\n  if (data.www) {\n    var a = document.createElement('a');\n    a.target = '_blank';\n    a.innerText = a.href = data.www;\n    www.appendChild(a);\n  }\n  if (data.linkedin) {\n    var a = document.createElement('a');\n    a.target = '_blank';\n    a.innerText = a.href = data.linkedin;\n    linkedin.appendChild(a);\n  }\n  if (data.github) {\n    var a = document.createElement('a');\n    a.target = '_blank';\n    a.innerText = a.href = data.github;\n    github.appendChild(a);\n  }\n\n  brand.querySelectorAll('[data-icon]').forEach(function (icon) {\n    var i = document.createElement('i');\n    i.className = icon.getAttribute('data-icon');\n    icon.appendChild(i);\n  });\n\n  var lang = document.querySelector('html').lang;\n  var dateFormat = getDateFormat(lang);\n  moment.locale(lang);\n  date.innerHTML = moment().format(dateFormat);\n  window.setInterval(function () {\n    date.innerHTML = moment().format(dateFormat);\n  }, 1000);\n\n  if (data.position && data.position.length) {\n    var select = document.createElement('select');\n    select.onchange = function (e) {\n      getCL({\n        url: this.value,\n        success: function (text) {\n          body.contentEditable = true;\n          body.innerHTML = marked(text);\n          body.style.display = 'inherit';\n          signal.style.display = 'inherit';\n        }\n      });\n    }\n    position.appendChild(select);\n    data.position.forEach(function (pos, i) {\n      if (i === 0) {\n        var placeholder = document.createElement('option');\n        placeholder.text = position.getAttribute('data-placeholder');\n        placeholder.disabled = true;\n        placeholder.selected = true;\n        select.appendChild(placeholder);\n      }\n      var option = document.createElement('option');\n      option.value = pos.file;\n      option.text = pos.name;\n      select.appendChild(option);\n    });\n    signal.onclick = function () {\n      var step = 2;\n      var accelerate = 2;\n      var current = window.scrollY;\n      var ani = requestAnimationFrame(function fn() {\n        if (window.scrollY < body.offsetTop - accelerate) {\n          current = current + step;\n          step = step + accelerate;\n          accelerate = accelerate * 1.2;\n          window.scrollTo(0, current);\n          ani = requestAnimationFrame(fn);\n        } else {\n          window.scrollTo(0, body.offsetTop);\n          cancelAnimationFrame(ani);\n        }\n      });\n    };\n  }\n}\n\nfunction generate(data) {\n  if (typeof data === 'object') {\n    fillBrand(data);\n  }\n}\n\nfunction getCL(options) {\n  if (!options.url) return;\n  var request = new XMLHttpRequest();\n  request.open('get', options.url);\n  request.responseType = 'text';\n  request.addEventListener('readystatechange', function () {\n    if (request.readyState === 4 && request.status === 200 && request.response) {\n      options.success && options.success(request.response);\n    }\n  });\n  request.send();\n}\n\nfunction getJSON(options) {\n  if (!options.url) return;\n  var request = new XMLHttpRequest();\n  request.open('get', options.url);\n  request.responseType = 'json';\n  request.addEventListener('readystatechange', function () {\n    if (request.readyState === 4 && request.status === 200 && request.response) {\n      options.success && options.success(request.response);\n    }\n  });\n  request.send();\n}\n\ngetJSON({\n  url: 'data.json',\n  success: generate\n});"}