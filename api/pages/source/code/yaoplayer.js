{"title":"","date":"2022-01-04T16:54:21.861Z","updated":"2022-01-04T16:46:48.517Z","comments":true,"path":"api/pages/source/code/yaoplayer.js","covers":null,"excerpt":"","content":"/**\n* Based on jQuery, fontawesome\n*/\n(function (window, document) {\n  var _player = function (id, playlist) {\n    if (playlist == undefined || playlist == null || playlist.length < 1) {\n      /** sample\n      playlist = [\n        {\n          'name': 'Test',\n          'singer': 'Tester',\n          'lrc': 'Not found',\n          'pic': 'https://s.gravatar.com/avatar/91c1b1d830c2daab93ac478c9852c2c8?s=72',\n          'url': 'test.mp3'\n        }\n      ]\n      */\n      return;\n    }\n\n    var audio = document.createElement('audio');\n\n    // Layout\t\t\n    var $outer = $('<div></div>').css({\n      'position': 'fixed',\n      'right': '-208px',\n      'top': '56px',\n      'box-shadow': '0 0 1px grey',\n      'width': '280px',\n      'background-color': 'white'\n    }).attr('id', id);\n\n    var $coverButton = this.Component.CoverButton();\n    var $prevButton = this.Component.ControlButton({\n      'icon': '<i class=\"fas fa-angle-left\"></i>'\n    });\n    var $playButton = this.Component.CustomPlayControlButton();\n    var $nextButton = this.Component.ControlButton({\n      'icon': '<i class=\"fas fa-angle-right\"></i>'\n    });\n    var $listButton = this.Component.ControlButton({\n      'icon': '<i class=\"fas fa-list\"></i>'\n    });\n    var $lyricButton = this.Component.ControlButton({\n      'icon': '<i class=\"fas fa-align-center\"></i>'\n    });\n    var $modeButton = this.Component.CustomModeControlButton();\n    var $songInfo = this.Component.SongInfo();\n    var $progressBar = this.Component.ProgressBar();\n    var $progressLabel = this.Component.ProgressLabel();\n    var $lyricView = this.Component.LyricView();\n    var $volumeButton = this.Component.CustomVolumeControlButton(function (volume) { // interface\n      audio.volume = volume;\n    });\n    var $listView = this.Component.ListView(playlist);\n    var $extra = this.Component.InOut();\n\n    // ...\n\n    $outer.append($coverButton);\n    $outer.append($songInfo);\n    $outer.append($prevButton);\n    $outer.append($playButton);\n    $outer.append($nextButton);\n    $outer.append($listButton);\n    $outer.append($lyricButton);\n    $outer.append($modeButton);\n    $outer.append($volumeButton);\n    $outer.append($progressBar);\n    $outer.append($progressLabel);\n    $outer.append($listView);\n    $outer.append($lyricView);\n    $outer.append($extra);\n\n    $songInfo.css({\n      'position': 'absolute',\n      'top': '0',\n      'left': '76px',\n      'width': '144px'\n    })\n    $volumeButton.css({\n      'position': 'absolute',\n      'top': '48px',\n      'right': '4px'\n    })\n    $modeButton.css({\n      'position': 'absolute',\n      'top': '48px',\n      'right': '28px'\n    })\n    $nextButton.css({\n      'position': 'absolute',\n      'top': '48px',\n      'right': '52px'\n    })\n    $playButton.css({\n      'position': 'absolute',\n      'top': '48px',\n      'right': '76px'\n    })\n    $prevButton.css({\n      'position': 'absolute',\n      'top': '48px',\n      'right': '100px'\n    })\n    $listButton.css({\n      'position': 'absolute',\n      'top': '0',\n      'right': '4px'\n    })\n    $lyricButton.css({\n      'position': 'absolute',\n      'top': '0',\n      'right': '28px'\n    })\n    $progressBar.css({\n      'position': 'absolute',\n      'top': '24px',\n      'left': '72px'\n    })\n    $progressLabel.css({\n      'position': 'absolute',\n      'top': '48px',\n      'left': '76px',\n      'width': '72px'\n    })\n    $listView.css({\n      'display': 'none'\n    })\n    $lyricView.css({\n      'display': 'none'\n    })\n\n    // Setting\n    var currentVolume = 0.69;\n    var currentIndex = 0;\n    var currentMode = this.Component.MODE_NORMAL;\n    var currentPlayState = false;\n    var mouseDownTemp = -1;\n    var mouseUpTemp = -1;\n    var prevStack = [];\n    var _player_self = this;\n\n    // Interface\t\t\n    $listButton.click(function () {\n      $lyricView.hide();\n      $listView.slideToggle();\n    });\n    $lyricButton.click(function () {\n      $listView.hide();\n      $lyricView.slideToggle();\n    });\n    $coverButton.click(function () {\n      if (audio.paused && audio.readyState >= 3) {\n        audio.play();\n        audio.autoplay = true;\n      } else {\n        audio.pause();\n        audio.autoplay = false;\n      }\n    });\n    $playButton.click(function () {\n      if (audio.paused && audio.readyState >= 3) {\n        audio.play();\n        audio.autoplay = true;\n      } else {\n        audio.pause();\n        audio.autoplay = false;\n      }\n    });\n    $nextButton.click(function () {\n      if (currentMode == _player_self.Component.MODE_NORMAL\n        || currentMode == _player_self.Component.MODE_REPEAT) {\n        prevStack.push(currentIndex);\n        currentIndex += 1;\n        if (currentIndex >= playlist.length) {\n          currentIndex = 0;\n        }\n      } else if (currentMode == _player_self.Component.MODE_RANDOM) {\n        prevStack.push(currentIndex);\n        currentIndex = Math.floor(Math.random() * playlist.length);\n      }\n      audio.src = playlist[currentIndex].url + '&br=128000';\n      audio.load();\n    });\n    $prevButton.click(function () {\n      if (prevStack.length > 0) {\n        currentIndex = prevStack.pop();\n      } else if (currentMode == _player_self.Component.MODE_NORMAL\n        || currentMode == _player_self.Component.MODE_REPEAT) {\n        currentIndex -= 1;\n        if (currentIndex < 0) {\n          currentIndex = playlist.length - 1;\n        }\n      } else if (currentMode == _player_self.Component.MODE_RANDOM) {\n        currentIndex = Math.floor(Math.random() * playlist.length);\n      }\n      audio.src = playlist[currentIndex].url + '&br=128000';\n      audio.load();\n    });\n    $listView.children('div').click(function () {\n      prevStack.push(currentIndex);\n      currentIndex = $(this).index();\n      audio.src = playlist[currentIndex].url + '&br=128000';\n      audio.load();\n    });\n    $modeButton.click(function () {\n      currentMode += 1;\n      if (currentMode > 2) {\n        currentMode = 0;\n      }\n      $modeButton.setMode(currentMode);\n    });\n    $progressBar.mousedown(function (e) {\n      mouseDownTemp = e.pageX - e.currentTarget.offsetLeft - e.currentTarget.offsetParent.offsetLeft;\n      mouseUpTemp = mouseDownTemp / e.currentTarget.offsetWidth;\n      $progressBar.setCurrentProgress(mouseUpTemp);\n    });\n    $progressBar.mousemove(function (e) {\n      mouseUpTemp = (e.pageX - e.currentTarget.offsetLeft - e.currentTarget.offsetParent.offsetLeft) / e.currentTarget.offsetWidth;\n      if (mouseDownTemp >= 0) {\n        $progressBar.setCurrentProgress(mouseUpTemp);\n      }\n    });\n    $progressBar.mouseup(function (e) {\n      if (mouseDownTemp >= 0) {\n        audio.currentTime = mouseUpTemp * audio.duration;\n        mouseDownTemp = -1;\n      }\n    });\n    $progressBar.mouseleave(function (e) {\n      if (mouseDownTemp >= 0) {\n        audio.currentTime = mouseUpTemp * audio.duration;\n        mouseDownTemp = -1;\n      }\n    });\n\n    audio.onabort = audio.onerror = function () {\n      $songInfo.setSongInfo({\n        'name': 'Error',\n        'singer': 'Error'\n      });\n      $coverButton.setCover('https://s.gravatar.com/avatar/91c1b1d830c2daab93ac478c9852c2c8?s=72');\n    };\n    audio.onpause = function () {\n      currentPlayState = false;\n      $coverButton.setPlayState(currentPlayState);\n      $playButton.setPlayState(currentPlayState);\n    };\n    audio.onplay = function () {\n      currentPlayState = true;\n      $coverButton.setPlayState(currentPlayState);\n      $playButton.setPlayState(currentPlayState);\n    };\n    audio.onloadstart = function () {\n      $coverButton.setPlayState(currentPlayState);\n      $playButton.setPlayState(currentPlayState);\n\n      $listView.setCurrentIndex(currentIndex);\n      $songInfo.setSongInfo(playlist[currentIndex]);\n      $coverButton.setCover(playlist[currentIndex].pic.replace('http://', 'https://') || 'https://s.gravatar.com/avatar/91c1b1d830c2daab93ac478c9852c2c8?s=72');\n      $progressBar.setLoadingProgress(0);\n      $progressBar.setCurrentProgress(0);\n      $progressLabel.setTimePass(0);\n      $progressLabel.setTimeTotal(playlist[currentIndex].time || '??:??');\n      setTimeout(function () {\n        $.get(playlist[currentIndex].lrc.replace('http://', 'https://'), function (data) {\n          $lyricView.setLyric(data.replace(/\\[[0-9:\\.]+\\]/g, '').replace(/\\n/g, '<br>'));\n        }, 'text');\n      }, 1000);\n    };\n    audio.onprogress = function (e) {\n      if (e.target.buffered.length > 0) {\n        $progressBar.setLoadingProgress(e.target.buffered.end(0) / e.target.duration);\n      }\n    };\n    audio.ontimeupdate = function (e) {\n      if (e.target.currentTime >= 0) {\n        if (mouseDownTemp == -1) {\n          $progressBar.setCurrentProgress(e.target.currentTime / e.target.duration);\n        }\n        $progressLabel.setTimePass(Math.floor(e.target.currentTime));\n      }\n    };\n    audio.onended = function () {\n      if (currentMode == _player_self.Component.MODE_NORMAL) {\n        prevStack.push(currentIndex);\n        currentIndex += 1;\n        if (currentIndex >= playlist.length) {\n          currentIndex = 0;\n        }\n      } else if (currentMode == _player_self.Component.MODE_REPEAT) {\n        audio.load();\n        return;\n      } else if (currentMode == _player_self.Component.MODE_RANDOM) {\n        prevStack.push(currentIndex);\n        currentIndex = Math.floor(Math.random() * playlist.length);\n      }\n      audio.src = playlist[currentIndex].url + '&br=128000';\n      audio.load();\n    };\n\n    // Extra Initialize\n    $coverButton.setPlayState(currentPlayState);\n    $coverButton.setCover('https://s.gravatar.com/avatar/91c1b1d830c2daab93ac478c9852c2c8?s=72');\n    $playButton.setPlayState(currentPlayState);\n    $volumeButton.setVolume(currentVolume);\n    $modeButton.setMode(currentMode);\n    $songInfo.setSongInfo(playlist[currentIndex]);\n    $progressBar.setLoadingProgress(0);\n    $progressBar.setCurrentProgress(0);\n    $progressLabel.setTimePass(0);\n    $progressLabel.setTimeTotal(playlist[currentIndex].time || '??:??');\n    $listView.setCurrentIndex(currentIndex);\n\n    audio.src = playlist[currentIndex].url + '&br=128000';\n    audio.load();\n\n    // Extra...\n    var inOutState = false;\n    $extra.mousedown(function () {\n      if (inOutState) {\n        $outer.animate({ 'right': '-208px' });\n        $listView.slideUp();\n        $lyricView.slideUp();\n        $extra.setIn();\n      } else {\n        $outer.animate({ 'right': '0' });\n        $extra.setOut();\n      }\n      inOutState = !inOutState;\n    });\n\n    return $outer;\n  };\n\n  _player.prototype = {\n    constructor: _player,\n    Component: {\n      MODE_NORMAL: 0,\n      MODE_REPEAT: 1,\n      MODE_RANDOM: 2,\n      InOut: function () {\n        var $div = $('<div></div>').css({\n          'height': '72px',\n          'font-size': '16px',\n          'user-select': 'none',\n          'background-color': '#ffffffaa',\n          'position': 'absolute',\n          'left': '-16px',\n          'top': '0',\n          'width': '16px',\n          'text-align': 'center',\n          'color': 'black'\n        });\n        var $i = $('<i class=\"fas fa-angle-left\"></i>').css({\n          'margin': '28px 0'\n        });\n        $div.append($i);\n\n        $div.hover(function () {\n          $(this).css({\n            'background-color': '#102a4baa',\n            'color': 'white'\n          });\n        }, function () {\n          $(this).css({\n            'background-color': '#ffffffaa',\n            'color': 'black'\n          });\n        });\n        $div.setIn = function () {\n          $(this).children('i').removeClass('fa-angle-right').addClass('fa-angle-left');\n        };\n        $div.setOut = function () {\n          $(this).children('i').removeClass('fa-angle-left').addClass('fa-angle-right');\n        };\n\n        return $div;\n      },\n      LyricView: function () {\n        var $div = $('<div></div>').css({\n          'height': '156px',\n          'font-size': '14px',\n          'border-top': '1px solid lightgrey',\n          'user-select': 'text',\n          'overflow-y': 'auto',\n          'padding': '4px'\n        });\n        $div.append('<p></p>');\n\n        $div.setLyric = function (html_text) {\n          if (html_text.trim() == \"\") {\n            $(this).children('p').html('Not found');\n          } else {\n            $(this).children('p').html(html_text);\n          }\n        };\n\n        return $div;\n      },\n      ListView: function (list) {\n        var $div = $('<div></div>').css({\n          'height': '156px', // (14 + 6 * 2)px * 6\n          'line-height': '100%',\n          'font-size': '14px',\n          'border-top': '1px solid lightgrey',\n          'cursor': 'pointer',\n          'user-select': 'none',\n          'overflow-y': 'auto'\n        });\n\n        list.forEach(function (song, i) {\n          var $item = $('<div></div>').css({\n            'height': '14px',\n            'padding': '6px'\n          });\n          var $signal = $('<div></div>').css({\n            'float': 'left',\n            'display': 'inline-block',\n            'height': '14px',\n            'width': '6px',\n            'background-color': 'goldenrod',\n            'margin-right': '8px',\n            'box-sizing': 'content-box',\n            'display': 'none'\n          });\n          var $index = $('<span></span>').css({\n            'float': 'left',\n            'margin-right': '8px',\n            'box-sizing': 'content-box'\n          }).text(i + 1);\n          var $title = $('<span></span>').css({\n            'float': 'left',\n            'box-sizing': 'content-box',\n            'text-overflow': 'ellipsis',\n            'white-space': 'nowrap',\n            'width': '152px', // 228px * 2/3\n            'overflow': 'hidden'\n          }).text(song.name);\n          var $artist = $('<span></span>').css({\n            'float': 'right',\n            'box-sizing': 'content-box',\n            'text-overflow': 'ellipsis',\n            'white-space': 'nowrap',\n            'width': '76px', // 228px * 1/3\n            'overflow': 'hidden',\n            'text-align': 'right'\n          }).text(song.singer);\n\n          $item.append($signal);\n          $item.append($index);\n          $item.append($title);\n          $item.append($artist);\n          $div.append($item);\n        });\n\n        $div.children('div').hover(function () {\n          $(this).css('background-color', '#eee');\n        }, function () {\n          $(this).css('background-color', 'transparent');\n        });\n\n        $div.setCurrentIndex = function (index) {\n          $(this).children('div').css('padding', '6px');\n          $(this).children('div').children('div').hide();\n          $(this).children('div').eq(index).css('padding', '6px 6px 6px 0');\n          $(this).children('div').eq(index).children('div').show();\n        };\n\n        return $div;\n      },\n      ProgressLabel: function () {\n        var $div = $('<div></div>').css({\n          'height': '12px',\n          'line-height': '100%',\n          'font-size': '12px',\n          'padding': '6px 4px',\n          'width': '68px',\n          'user-select': 'none'\n        });\n\n        var $timePass = $('<span></span>');\n        var $timeTotal = $('<span></span>');\n\n        $div.append($timePass);\n        $div.append(' / ');\n        $div.append($timeTotal);\n\n        $div.setTimeTotal = function (seconds) {\n          if (seconds == '??:??') {\n            $(this).children('span').eq(1).text('??:??');\n            return;\n          }\n          var min = Math.floor(seconds / 60);\n          var sec = seconds % 60;\n          if (min < 10) {\n            min = '0' + min;\n          }\n          if (sec < 10) {\n            sec = '0' + sec;\n          }\n          $(this).children('span').eq(1).text(min + ':' + sec);\n        };\n\n        $div.setTimePass = function (seconds) {\n          var min = Math.floor(seconds / 60);\n          var sec = seconds % 60;\n          if (min < 10) {\n            min = '0' + min;\n          }\n          if (sec < 10) {\n            sec = '0' + sec;\n          }\n          $(this).children('span').eq(0).text(min + ':' + sec);\n        };\n\n        return $div;\n      },\n      ProgressBar: function () {\n        var $div = $('<div></div>').css({\n          'width': '200px',\n          'height': '16px',\n          'padding': '4px',\n          'cursor': 'pointer',\n          'overflow': 'hidden',\n          'user-select': 'none'\n        });\n\n        var $progressInner = $('<div></div>').css({\n          'width': 'calc(100% - 8px)',\n          'height': '4px',\n          'margin': '7px 4px',\n          'background-color': '#d3d3d3',\n          'border-radius': '2px',\n          'position': 'relative',\n          'pointer-events': 'none'\n        });\n\n        var $progressLoading = $('<div></div>').css({\n          'min-width': '4px',\n          'max-width': 'calc(100% - 8px)',\n          'width': 'calc(75% - 8px)',\n          'height': '4px',\n          'margin': '7px 4px',\n          'background-color': '#aaa',\n          'border-radius': '2px',\n          'position': 'relative',\n          'top': '-11px',\n          'pointer-events': 'none'\n        });\n\n        var $progressCurrent = $('<div></div>').css({\n          'min-width': '4px',\n          'max-width': 'calc(100% - 8px)',\n          'width': 'calc(50% - 8px)',\n          'height': '4px',\n          'margin': '7px 4px',\n          'background-color': '#000',\n          'border-radius': '2px',\n          'float': 'left',\n          'position': 'relative',\n          'top': '-29px',\n          'pointer-events': 'none'\n        });\n\n        var $progressThumb = $('<div></div>').css({\n          'width': '4px',\n          'height': '4px',\n          'border-radius': '50%',\n          'border': '4px solid goldenrod',\n          'margin': '3px 0',\n          'margin-left': '-12px',\n          'float': 'left',\n          'position': 'relative',\n          'top': '-29px',\n          'pointer-events': 'none'\n        });\n\n        $div.append($progressInner);\n        $div.append($progressLoading);\n        $div.append($progressCurrent);\n        $div.append($progressThumb);\n\n        $div.setCurrentProgress = function (progress) {\n          $(this).children('div').eq(2).css('width', progress * 100 + '%');\n        };\n\n        $div.setLoadingProgress = function (progress) {\n          $(this).children('div').eq(1).css('width', progress * 100 + '%');\n        };\n\n        return $div;\n      },\n      ControlButton: function (options) {\n        var $div = $('<div></div>')\n          .css({\n            'width': '16px',\n            'height': '16px',\n            'line-height': '100%',\n            'font-size': '16px',\n            'padding': '4px',\n            'opacity': '0.6',\n            'display': 'inline-block',\n            'text-align': 'center',\n            'cursor': 'pointer',\n            'vertical-align': 'middle'\n          })\n          .html(options.icon || '<i class=\"fas fa-image\"></i>')\n          .css(options.css || {})\n          .hover(function () {\n            $(this).css('opacity', '1');\n          }, function () {\n            $(this).css('opacity', '0.6');\n          });\n\n        $div.setIcon = function (icon) {\n          $(this).html(icon || '<i class=\"fas fa-image\"></i>');\n        };\n\n        return $div;\n      },\n      CoverButton: function () {\n        var $div = $('<div></div>').css({\n          'width': '72px',\n          'height': '72px',\n          'cursor': 'pointer',\n          'background-color': 'goldenrod',\n          'background-size': 'cover',\n          'background-repeat': 'no-repeat',\n          'color': 'white'\n        });\n\n        $div.html('<i class=\"far fa-play-circle\"></i>');\n        $div.children('i').css({\n          'line-height': '100%',\n          'font-size': '32px',\n          'opacity': '0.8',\n          'position': 'relative',\n          'top': '20px',\n          'left': '20px',\n          'text-shadow': '0 0 0.1px black'\n        });\n\n        $div.hover(function () {\n          $(this).children('i').css('opacity', '1');\n        }, function () {\n          $(this).children('i').css('opacity', '0.8');\n        });\n\n        $div.setPlayState = function (state) {\n          if (state) {\n            $(this).children('i')\n              .removeClass('fa-play-circle')\n              .addClass('fa-pause-circle')\n              .animate({\n                'font-size': '20px',\n                'top': '48px',\n                'left': '48px'\n              });\n          } else {\n            $(this).children('i')\n              .removeClass('fa-pause-circle')\n              .addClass('fa-play-circle')\n              .animate({\n                'font-size': '32px',\n                'top': '20px',\n                'left': '20px'\n              });\n          }\n        };\n\n        $div.setCover = function (cover) {\n          $(this).css('background-image', 'url(' + cover + ')');\n        };\n\n        return $div;\n      },\n      SongInfo: function () {\n        var $div = $('<div></div>').css({\n          'height': '16px',\n          'line-height': '100%',\n          'padding': '4px',\n          'cursor': 'default',\n          'user-select': 'text',\n          'white-space': 'nowrap',\n          'text-overflow': 'ellipsis',\n          'overflow': 'hidden'\n        });\n\n        var $title = $('<span></span>').css({\n          'font-size': '16px',\n          'color': 'black'\n        });\n        var $artist = $('<span></span>').css({\n          'font-size': '14px',\n          'color': 'darkgrey'\n        });\n\n        $div.append($title);\n        $div.append(' - ');\n        $div.append($artist);\n\n        $div.setSongInfo = function (options) {\n          if (options.name) {\n            $(this).children('span').eq(0).text(options.name);\n          }\n          if (options.singer) {\n            $(this).children('span').eq(1).text(options.singer);\n          }\n        };\n\n        return $div;\n      },\n      CustomPlayControlButton: function () {\n        var $playButton = this.ControlButton({\n          'icon': '<i class=\"far fa-play-circle\"></i>',\n          'css': {\n            'width': '18px',\n            'height': '18px',\n            'font-size': '18px',\n            'padding': '3px'\n          }\n        });\n\n        $playButton.setPlayState = function (state) {\n          if (state) {\n            $(this).children('i')\n              .removeClass('fa-play-circle')\n              .addClass('fa-pause-circle');\n          } else {\n            $(this).children('i')\n              .removeClass('fa-pause-circle')\n              .addClass('fa-play-circle');\n          }\n        };\n\n        return $playButton;\n      },\n      CustomVolumeControlButton: function (volumeChangedListener) {\n        var $volumeButton = this.ControlButton({\n          'icon': '<i class=\"fas fa-volume-down\"></i>'\n        }).css('width', '16px');\n\n        var $volumeBar = $('<div></div>').css({\n          'width': '6px',\n          'height': '48px',\n          'border-radius': '8px',\n          'box-shadow': '0 0 0 1px',\n          'margin': '4px 6px',\n          'overflow': 'hidden',\n          'margin-right': '-52px',\n          'background-color': 'white',\n          'z-index': '99999',\n          'position': 'fixed'\n        });\n\n        var $volumeBarInner = $('<div></div>').css({\n          'background-color': 'goldenrod',\n          'height': '50%',\n          'width': '100%'\n        });\n\n        $volumeBar.mousedown(function (e) {\n          $(this).children('div').css('height', e.offsetY);\n          var volume = e.offsetY / $(this).height();\n          $(this).siblings('i').removeClass('fa-volume-off fa-volume-down fa-volume-up');\n          if (volume < 0.3) {\n            $(this).siblings('i').addClass('fa-volume-off');\n          } else if (volume < 0.7) {\n            $(this).siblings('i').addClass('fa-volume-down');\n          } else {\n            $(this).siblings('i').addClass('fa-volume-up');\n          }\n          if (volumeChangedListener) {\n            volumeChangedListener(volume);\n          }\n        });\n\n        $volumeButton.children('i').click(function () {\n          $(this).siblings('div').children('div').css('height', 0);\n          $(this).removeClass('fa-volume-down fa-volume-up')\n            .addClass('fa-volume-off');\n          if (volumeChangedListener) {\n            volumeChangedListener(0);\n          }\n        });\n\n        $volumeButton.hover(function () {\n          $(this).children('div').show();\n        }, function () {\n          $(this).children('div').hide();\n        });\n\n        $volumeBar.hide();\n\n        $volumeBar.append($volumeBarInner);\n        $volumeButton.append($volumeBar);\n\n        $volumeButton.setVolume = function (volume) {\n          $(this).children('div').children('div').css('height', $(this).children('div').height() * volume);\n          $(this).siblings('i').removeClass('fa-volume-off fa-volume-down fa-volume-up');\n          if (volume < 0.3) {\n            $(this).children('i').addClass('fa-volume-off');\n          } else if (volume < 0.7) {\n            $(this).children('i').addClass('fa-volume-down');\n          } else {\n            $(this).children('i').addClass('fa-volume-up');\n          }\n          if (volumeChangedListener) {\n            volumeChangedListener(volume);\n          }\n        };\n\n        return $volumeButton;\n      },\n      CustomModeControlButton: function () {\n        var $modeButton = this.ControlButton({\n          'icon': '<i class=\"fas fa-exchange-alt\"></i>'\n        });\n\n        var normal = this.MODE_NORMAL;\n        var repeat = this.MODE_REPEAT;\n        var random = this.MODE_RANDOM;\n\n        $modeButton.setMode = function (mode) {\n          if (mode == normal) {\n            $(this).children('i')\n              .removeClass('fa-redo-alt fa-random')\n              .addClass('fa-exchange-alt');\n          } else if (mode == repeat) {\n            $(this).children('i')\n              .removeClass('fa-exchange-alt fa-random')\n              .addClass('fa-redo-alt');\n          } else if (mode == random) {\n            $(this).children('i')\n              .removeClass('fa-redo-alt fa-exchange-alt')\n              .addClass('fa-random');\n          }\n        };\n\n        return $modeButton;\n      }\n    }\n\n  };\n\n  window.YaoPlayer = _player;\n})(window, document);"}